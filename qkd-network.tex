\subsection{Article}

\subsubsection*{Abstract}
The convergence of quantum cryptography with applications used in everyday life is a topic drawing attention from the industrial and academic worlds. The development of quantum electronics has led to the practical achievement of quantum devices that are already available on the market and waiting for their first application on a broader scale. A major aspect of quantum cryptography is the methodology of Quantum Key Distribution (QKD), which is used to generate and distribute symmetric cryptographic keys between two geographically separate users using the principles of quantum physics. In previous years, several successful QKD networks have been created to test the implementation and interoperability of different practical solutions. This article surveys previously applied methods, showing techniques for deploying QKD networks and current challenges of QKD networking. Unlike studies focusing on optical channels and optical equipment, this survey focuses on the network aspect by considering network organization, routing and signaling protocols, simulation techniques, and a software-defined QKD networking approach.


\subsubsection{Introduction}
Establishing secure cryptographic keys through untrusted networks is one of the most fundamental cryptographic tasks [1]. While the use of public key infrastructure based on computationally complex mathematical problems and assumptions about the computational power of eavesdroppers prevail, these belong to the group of theoretically breakable computational security solutions.
They are therefore under threat as computational power continues to increase and as quantum computing algorithms emerge that can break some widely used computationally complex mathematical problems in polynomial time [2, 3]. Quantum Key Distribution, known as QKD [4], is based on the principles of quantum information theory and allows to establish information-secure cryptographic keys that do not depend on these constraints, at least on a protocol level. A suitable message authentication scheme, such as Wegman-Carter [5], should be combined with QKD to this end [6, 7].
QKD networks differ significantly from traditional telecommunication networks due to the specificity of QKD links and network organization. Restrictions such as limited key generation rate and reachable distance (Section 2), present lack of quantum repeaters (Section 3.2), specific routing due to the use of public and quantum channels in quantum links (Section 6), and network organization that for now has to employ a hop-by-hop key transport approach (Section 5.2.2) are the motivations for this survey. Although several studies on QKD link and QKD quantum channel scan be found [8–10], this survey focuses on QKD networking, network organization, routing and signaling protocols, and software-defined QKD networking techniques. After reading this survey,interested readers will have an insight into quantum networks from an engineering perspective and be familiar with the modes of functioning, realization, existing solutions, and methods of simulating quantum cryptographic networks. This survey provides a high-level view of QKD networks and is of use and interest to researchers, practitioners of QKD network design, and PhD students in the field of applied quantum cryptography.
The survey is organized as follows: Section 2 introduces the features of QKD links. Section 3 summarizes the limitations and basic characteristics of QKD networks and explains how they are practically implemented. QKD network types are described in Section 4. Section 5 covers previously deployed QKD networks. QKD network routing techniques are discussed in Section 6. Section 7 provides an overview of QKD software-defined networking. Section 8 concludes this survey.

The survey includes the supplementary material with additional QKD networks listed in Section 1 and simulation techniques discussed in Section 2. Overview of signaling network protocols is given in Section 3, while QKD header and QKD packet encapsulation are discussed in supplementary material, Section 4. Section 5 provides an overview of work in QKD standardization process.
The graphical outline of the survey structure is shown in Figure 1.
\subsubsection{QKD LINKS}
A QKD link, or simply, "link," denotes a logical connection between two remote QKD nodes connected by a quantum channel used for transmitting photons and a public channel used for postprocessing the exchanged information, respectively. The disadvantage of this type of link is reflected in a limited quantum channel key generation rate, available to the parties connected by a direct optical fiber or free line-of-sight in a point-to-point (P2P) manner over a certain distance.
However, it is also a necessary condition for secure key generation.
Although fiber is a good and commonly used medium for transmitting qubits, the installation of a dedicated optical channel for QKD purposes is not practical in all circumstances. 1 A free space link is sometimes convenient, although it has its drawbacks, since it needs suitable atmospheric conditions, a visible light path, and an acceptable signal-to-noise ratio (SNR) that strictly limits usage time. Nevertheless, the results obtained from experiments in Los Alamos [17] and Munich in which a link between the ground and an aircraft flying at 290 km/h was established [18] demonstrated promise with satellite connections [17–23]. After performing a sequence of free space QKD experiments on the ground, China successfully launched the quantum satellite “Micius,” which demonstrated a satellite-to-ground QKD over a distance of 645 to 1200 kilometers [24].
The maximum distance, over which key can be generated, decreases with increasing losses and optical detector noise. For a given detector and settings, the detector’s dark-count 2 rate is constant, but key rate decreases with distance due to increase of cumulative losses. In current commercial optical fiber systems, the distance of a QKD link is roughly limited to 100 km, while the key rate is limited to a few tens or hundreds of [26, 27]. Due to the limited key rate, key storage is installed at both endpoints of the corresponding link. This storage is gradually filled with new key material, and the available key material is subsequently used to encrypt/decrypt data flows [28].
The amount of data to be encrypted and the encryption algorithm type determine the rate of key storage discharge, or, simply, the key consumption rate. The key rate of the link is otherwise referred to as the key charging rate [28–31]. The QKD link can be designated “currently unavailable” when no available key material in key storage is found, as no cryptographic operations can be performed [32]. It is also worth noting that an apparently optimal strategy for QKD devices is to continuously generate keys with maximum intensity until the storage is full (which depends on how it is implemented) [28, 33].
A key can be used to encrypt communication over a public channel using a One Time Pad(OTP) cipher and ITS authentication scheme such as Wegman-Carter [34, 35]. Since an OTP cipher requires the same amount of key that corresponds to the length of the message being encrypted and additional keys for ITS authentication, this approach consumes more key material than the message being transmitted. If not enough key material is available, OTP cannot be used, and the use of alternative cryptographic techniques such as Advanced Encryption Standard (AES), which does not require such a large amount of key consumption, is the most common choice [36].

\subsubsection{QKD NETWORKS}
QKD networks are used to extend the range of QKD systems and consist of static nodes that represent secure access points considered to have unlimited processing power and power supply. Because of the point-to-point behavior of the links connecting nodes, previously deployed testbeds [29, 37, 38] have shown that secure keys in QKD networks can be transmitted from node to node in a hop-by-hop manner (Section 5.2.2) or through a key repeater concept (Section 5.1.5).
Common to both networks is the assumption that all nodes in a network should be trusted[32, 39]. This assumption can be avoided if multipath communication Quantum Network Coding techniques are used [40]. In this survey, previously deployed QKD networks are briefly discussed,focusing on methods of communication, routing protocols, and network organization.
To facilitate organization, a QKD network has often been described using several layers[41, 42]:
• A quantum layer where a secure symmetrical key is established.
• A key management layer used to verify and manage the previously established key.
• A communication layer where the established key is used to secure data traffic.
As mentioned above, QKD is a key agreement primitive and as such is located in the lowest(basic) layer of the QKD network architecture. Taking into account different rates of key material consumption by different applications, a situation in which not enough key material is available to meet the needs of higher layers is not desirable. The quantum layer therefore needs to continuously establish key material. To provide a guaranteed level of service, the QKD network should have a detailed view in its resources and capacities. Previously deployed QKD networks did not have defined strategies for a quality assurance service. For example, the SECOQC QKD network,discussed in Section 5.2, was committed to the basic Best Effort service type, which only defines the average key rate and traffic burst, while the Guaranteed Key Rate service type had been suggested for improved versions of QKD networks [33].
Considering the comprehensive and detailed documentation available on quantum optical communications [26, 43–47], the emphasis of this publication is on the two upper layers. These layers can have different and independent network organization, as communication between nodes is achieved through existing standard connections, such as the Internet, where an arbitrary number of intermediate devices can be included (Figure 2). The key management layer is in charge of managing the key storage resources, routing protocols, quality of service (QoS), and so on. The topmost communication layer uses previously established key material to encrypt data traffic by using an existing security protocol suite, such as Internet Protocol Security (IPSec) [14, 48].However, the described hierarchy distributes the responsibility for security across all three layers.
\subsubsection*{QKD Network Attributes}
QKD represents a new generation of security solutions that do not rely on the computational assumptions of problems presumed difficult. However, QKD networks must be integrated into the existing environment and need to meet certain criteria and conditions. Some of the most common requirements from QKD networks are listed below.
3.1.1 Key Rate. One of the vital parameters describing a QKD network is the average key rate of a QKD link. Since encryption and decryption operations cannot be performed without sufficient key material, the competition between the rate at which key material is stored in the key storage and the rate at which it is consumed for encryption and decryption operations has a major influence on network performance.
Comparing previously deployed QKD networks and testbeds chronologically, a rapid improvement in the development of quantum equipment is evident. QKD systems implemented in 2002 in the DARPA QKD network could achieve a key rate of approx. 400 bps over 10 km [29]. In 2007,in SECOQC, the maximum key rate was 3.1 kbps over 33 km [37]. The best performed solutions presented in Tokyo in 2009 achieved a key rate of 304 kbps over 45 km [38]. In 2017, China built the 2,000-km Beijing-Shanghai backbone QKD network with devices typically achieving key rates of 250 kbps over 43 km.
In the past 20 years, a steadily increasing secret key rate has been obtained with improved optical components and better electronics mainly in the detectors. For the latest jump to achieve record-high rates of around 10 Mbps [49], digital signal processing in FPGA was optimized. The throughput of measured qubits to enhance key rates has also been enhanced, especially for shorter links, by removing limitations without FPGA. A second race is open to achieving longer single span transmission distances [50–53] based on protocol enhancements as well as technological improvements leading to detectors with ever-decreasing dark count rates. 3 It could be argued that the development to improve single links on rates at short distances and maximum span will make QKD networks needless. The opposite is true, however, as the opportunity to open a mass market with these improvements at the link level seems low and unlikely to cover broad deployment scenarios specifically using the technical improvements from recent years. What the latest improvements genuinely enable is increased diversity in the links that can be potentially deployed in QKD networks.
It is therefore reasonable to expect that in the future, an optimal solution will significantly exceed the present key rate and distance values, although the race between generation and consumption of key material will remain.
3.1.2 Link Length. The fundamental constraint of a QKD link is the length over which secure key material can be generated (due to scattering and absorption of polarized photons and other factors [27, 44, 45, 54]), which limits the ability of quantum channels (direct optical links or free line-of-sight) to a certain distance. It is interesting to compare the lengths of links in previously built QKD networks. 4 The maximum length in the DARPA QKD network was a 29 km connection through the optical switch between Harvard and Boston Universities [29]. In SECOQC, the maximum length of the link was 82 km between the BREIT and St. Pölten nodes [37], while in Tokyo, the maximum connection between the nodes was a record 90 km between the Koganei-1and Koganei-2 nodes [58]. In the Beijing-Shanghai Backbone QKD network, the maximum link length is 89.3 km between Hefei and Wuwei.
In current systems with optical fibers, the distance over which QKD links can be effectively applied is limited to roughly 100 km [26, 27].
3.1.3 Protection of Key Material. The main reason for interest in QKD is the privacy of the established key material. This means that the nodes of a QKD network must be secured with a strong probability that the established key material is unique and inaccessible to third parties. The security of key material is evaluated not only when it is established but also when it is managed,stored, and eventually used. It is therefore important to secure each level of the QKD network architecture.
3.1.4 Key Usage. Because of scarce resources (generation key rate), communication in a network is reduced to a minimum, since each additional packet means spending an additional amount of previously established key material. Since communication is usually performed on a hop-by-hop basis that requires the trustworthiness of all nodes in the path, selecting the shortest routing path is necessary to minimize the number of nodes that can potentially be abducted or attacked by an eavesdropper. Also, involving longer paths requires a higher consumption of key material. During network congestion or problems in communication, used key material is deliberately discarded and new key material for retransmission is applied to reduce the risk of leaks [28]. Therefore,minimizing the number of hops is preferable.
3.1.5 Robustness. Because of the cost and manner of implementation, QKD networks will slowly integrate into traditional and everyday telecommunication environments. It is important then to ensure robustness, which is reflected in the gradual and seamless addition of new nodes and establishment of new links. A QKD network needs to provide adequate replacement paths to avoid defective nodes or nodes under severe attack. Regardless of the security techniques, remembering that attackers can easily find ways of terminating optical links and breaking QKD connections is important. A QKD network must have an adequate response to such situations.

Because traffic can be connected and directed between different network domains, network repeaters have a fundamental role in modern networking. Although theoretical and pioneering results in the field of quantum repeaters are available [59–62], in practice they remain unachievable with current technology [10, 27]. The idea behind a quantum repeater is to employ quantum entanglement of photons to communicate over different quantum links. Quantum entanglement is a key aspect in applying quantum communications and quantum information. In short, quantum entanglement implies that multiple particles are connected together in such a manner that the measurement of one particle’s quantum state determines the possible quantum states of the other particles. Even when particles are separated by large distances, they still make up a joint quantum system. Entanglement fidelity is a property used to describe how well the entanglement between two subsystems is preserved in a quantum process.
In theory, however, the application of entangled states and entanglement swapping is hindered by two main roadblocks. The first is that the greater the distance between two entangled systems,the lower the fidelity. In fact, the achievable fidelity of a quantum state decreases exponentially with the distance because of lossy quantum channels [27, 63]. 5 In this context, the concept of entanglement purification [64, 65] can be used to increase the fidelity of a single entangled state by using a number of noisy entangled states (as described in Reference [60]). However, this increases the number of required resources for transmitting each qubit over a quantum repeater (i.e., the number of entangled states). The second roadblock in achieving a quantum repeater following the scheme, for example, in References [60, 61], is that quantum memory is required a technology that is not practically available as of today. The use of quantum repeaters is essentially based on the idea of creating “chains” of entangled photons using a technique called entanglement swapping. Concepts either with quantum memories [66] or without [67] have been developed. Different building blocks for matching the transfer of the wavelengths of these flying qubits to quantum memory have been practically demonstrated [68, 69]. Internal loss and fidelity need to be improved to implement chains with one or more intermediate nodes working at higher rates. The first work to integrate future quantum repeaters in the overall infrastructure was recently published [70]. Each node in a QDK network therefore acts as a repeater and forwards packets or enanglement states of other nodes to enable quantum information sharing between QKD hosts.

\subsubsection{QKD NETWORK TYPES}
Although many hybrid realizations have been proposed, QKD networks can be grouped into two distinct categories: switched QKD networks and trusted repeater QKD networks.

Switched QKD networks consist of nodes connected to a dedicated, fully optical network. This network contains a switching mechanism used to establish a direct optical point-to-point QKD connection between any two nodes in the QKD network. The limitations on distance in point to-point QKD links restrict these networks to a metropolitan or regional scale [10]. Since every optical switch adds at least several dB of loss to the photonic path, optical switches can significantly reduce a network’s range.
The main drawback of switched QKD networks is the requirement of dedicated optical infrastructure for quantum channels, which is often not economically feasible. By contrast, the major advantage of this class of networks is the reliance on an optical switch that allows establishing a connection between two nodes without the active participation of other network nodes (Figure 3(a)).

Another drawback of switched QKD networks is the consistency of the applied QKD technique.
Combining different QKD techniques such as free-space QKD and QKD over fiber is not possible,since no suitable devices that could perform this transformation in the path are available. The first switched all-pass QKD network was described in Reference [71]. Four nodes were connected through an optical switch, and each of the QKD terminals was designed as a transceiver so they could establish a QKD link to one of the other three simultaneously.

In trusted repeater QKD networks, the security of each node along the transmission path is essential for securely transmitting information (hence the name). Point-to-point communication between two nodes provides identical keys to the nodes and thus enables secure communication (Sections 5.1.5 and 5.2.2). Taking into account the lack of a quantum repeater, nodes are also responsible for routing and forwarding mechanisms (Figure 3(b)). Organizing a network in this manner is its greatest drawback, because the security of transfer depends on the security of all the nodes in the path. However, trusted repeater networks are not limited by distance or node numbers and can be made up of different QKD devices implementing different QKD technologies.

Since the quantum channels can be “given” to the eavesdropper without compromising the security of QKD, a rational adversary would rather target the weaker link, being the node. The usual assumption is letting the nodes be “invulnerable,” which is the trusted repeater hypothesis. However,given that the optical device controls at some point will most likely have a conventional computer control logic, the security of the device is no better than the security of a classic computer running QKD algorithms and its physical protection.
The admittedly strong assumption of fully trusted repeaters can be relaxed in at least three ways:(i) use measurement device independent (MDI) QKD, (ii) use quantum repeaters, and (iii) rely on multiple paths.

This first approach has been described by Reference [72] and adds the assumption of perfect state preparation achievable by communication parties, as well as adding a potentially unstrusted location to the quantum channel. Measurements using Bell states and formal arguments for “unconditional security” have been supported with experimental demonstrations [73, 74]. Of course,the absence of the trusted repeater assumption in these proofs makes security much stronger than those assuming trusted repeater QKD. Note, however, that MDI QKD essentially prolongs the quantum channel but the two sender stations must still be situated in Trusted Repeater Nodes. This also holds true for the other alternatives outlined next (except possibly in the case when end-to-end quantum links could be established without intermediate Trusted Repeater Nodes).

The concept of quantum repeaters was discussed above (see Section 3.2). While practical demonstrations have been presented [61, 66, 67], the spatial distances the technology can overcome (as of today) strongly depend on the amount of fidelity induced by the entanglement swapping and the degree to which it can be handled (Section 3.2).
The third and most practical method today resorts to classic technology and employs multiple paths and threshold cryptographic techniques to mitigate the risk of eavesdropping. Roughly speaking, multipath transmission quantum networks trade trust in the repeaters for the assumption of the repeater being vulnerable to eavesdropping, the attacker being forced to intercept many of the intermediate devices to discover the message. Indeed, it can be shown that in absence of trusted repeaters, multiple paths are a theoretical necessity. At the same time, path redundancy also mitigates the issue of all QKD implementations being vulnerable to denial-of-service attacks(the adversary may passively eavesdrop not to get information, but to make the local quantum key stores run dry to enforce the endpoints to switch to conventional transmission techniques [75]).
Advanced routing mechanisms can be put to use to bypass lines with detected eavesdroppers.
Indeed, otherwise, attackers could try to break the security, employing passive eavesdropping to redirect traffic over vulnerable repeaters and thus get a hold of the secret key [76]. It can be shown[77, 78] that “end-to-end security” without trusted repeaters in quantum networks (without quantum repeaters) can be restored only under weak assumptions of the attack resilience of nodes [79].
Furthermore, using the same techniques, simultaneous multi-level security against other attacks can be achieved along the same lines to an arbitrarily selected level of service quality [80]. The topology of a quantum network generally has a strong impact on achievable security, and despite theoretical and practical progress in the construction of quantum networks, even without trusted repeaters [33, 36, 54], the problem remains computationally (in fact, NP-) hard in its most general form [81]. Methods for foiling covert channels and malicious classical post-processing units have been discussed in Reference [82].
\subsubsection*{QKD Overlay Networks}
While the previously described QKD network types relate to the organization of quantum channels, the QKD overlay network type refers to public channel realization. The primary goal of the overlay network is achieving the higher hierarchy network with the aim of providing a better QoS and utilizing the resources of lower-level networks. In doing so, the overlay network aims to be independent of the defined paths from Internet Service Providers (ISP). Finding alternative routes that can provide a service with a higher degree of quality and quick rerouting in the case of interrupt detection or using multipath communications are key features of the overlay network approach. The use of multipath connections is an often suggested solution for improving network work loads through protecting against network failures, network load balancing, large bandwidth implementation, low-delay time selection, and more [83–86]. Studies have shown that at least four link-disjoint paths between large ISPs are present in 90\% of point-of-presence pairs [87, 88].

It is known that routing between network domains using external routing protocols such as Border Gateway Protocol (BGP) results in slow response and recovery from network outages. Due to the time required to obtain information about interruptions or congestion on network links and the BGP minimum route advertisement interval timer settings, which is usually within minutes,the time needed to obtain a consistent view of the network after a link outage can reach tens of minutes, which is a long period for network applications. BGP also propagates only one route, and detecting the alternative route network nodes need in different situations is difficult [89].
The overlay network can help overcome these challenges by establishing the network with a peer-to-peer approach. The overlay network connects nodes in different domains and allows the use of alternative paths by encapsulating traffic to the traffic in the lower network. When an intermediate node in the path received the packet, the node will unpack the packet, analyze the IP address of the recipient, re-encapsulate packet again, and forward it further to network nodes that may be in other domains. Simply, it is a hop-by-hop approach popularly applied in QKD networking (Figure 4). Considering the encapsulation principle, overlay nodes independently perform link state measurements and can respond more quickly to link congestion by redirecting traffic to other less-congested links. Overlay networks can offer new functionality that is difficult to perform in lower-layer networks. The overlay QKD approach is attractive, since it can be used to bypass “untrusted” nodes and perform quick rerouting when trust in nodes is no longer valid or multipath communication is required [28, 33].
\subsubsection{PREVIOUSLY DEPLOYED QKD NETWORKS}
This section briefly discusses some previously deployed QKD networks. Since much of the literature deals with quantum optical infrastructure, the focus is placed on the logical structure of networks and topology, key storage and management solutions, key usage, and the solution’s performance.
\subsubsection{DARPA QKD Network}
The world’s first QKD network was the DARPA QKD Network, presented in December 2002 by BBN Technologies and Harvard and Boston Universities [14]. Initially, the network consisted of a weak-coherent BB84 transmitter pair (Anna and Alice), a pair of compatible receivers (Boris and Bob) and one 2x2 optical switch that could connect any sender to any receiver (Figure 5). Later, the network was extended with two free space QKD links, and the third planned free space link from QinetiQ (UK) was not explained in any official project documentation. The DARPA QKD network combined two previously explained types in a hybrid solution. The DARPA QKD network laid the foundation for the further development of trusted repeater QKD networks, but it also demonstrated practically the disadvantages of a switched QKD network type.
Two nodes (Alice and Bob) and a switch were located at BBN, while Anna and Boris were located at Harvard and Boston Universities (BU), respectively. BBN designed its own 2x2 optical switch and used it to connect Anna, Alice, Bob, and Boris. This switch was optically passive and therefore did not disturb the quantum state of photons. The switch was constructed by modifying a standard telecommunications facility switch. It operates by moving reflective elements that change the internal light path to produce either a BAR or CROSS connection. It is controlled through a direct line from Alice’s optical process computer (OPC) by applying a TTL-level pulse to either the BAR or CROSS pin for 20 ms to switch the activated position. According to Reference [29], switching time was 8 ms and optical loss was less than 1 dB.

A previously performed set of experiments presented results that measured degradation in the phase-modulated QDK incurred by optical switches [90]. A demonstration of QKD transmission and the results of insertion loss, which was the principal effect on QKD throughput in three different types of optical switches, yielded the following: 2x1 optical-mechanical switch (4.7 dB loss),
2x2 LiNbO3 switch (5.4 dB loss) and four-port MEMS switch (5.3 to 5.9 dB of loss).

5.1.1 BBN Protocol Suite. Considering that the DARPA QKD network was the first QKD network, no predefined protocols could be used for QKD communication over the public channel.
BBN therefore developed its own QKD protocol stack in C programming language. All messages were packed in IP datagrams to convey the control messages through the Internet [91].
Table 1 presents only the list of technologies used, while interested readers may refer to References [29, 92]. It can be seen that several techniques were used for different post-processing stages. The aim was to minimize the number of messages exchanged to speed up the key generation rate and reduce congestion caused by the sudden transfer of a large number of packets over a public channel. Figure 6(a) shows the basic format of BBN’s QKD Protocol datagram. Each datagram contains a packet header with details of the permitted, reliable, in-order transmission of the message, crash detection, and so on.
The datagram is filled with one or more messages of variable length, carrying the details needed to describe commands or a response to an action. It is important to emphasize that these datagrams are protected by an IPSec security mechanism in standard mode.
The aim was to create a secure tunnel between Quantum Protocol Daemons so all traffic over the public channel was encrypted, authenticated, and integrity-checked. An example of messages exchanged by BBN’s QKD Protocol is shown in Figure 6(b).
5.1.2 Key Management and Usage. In the final technical DARPA report [29], details for the originally planned and used technologies are given. It is interesting to note that the authors assumed the Diffie-Hellman (DF) key agreement primitive would be broken by 2015. Since the average key rate of a QKD device was 1 kbps, the goal was to introduce QKD as a new key agreement solution and integrate it with existing IPSec and IKE (Internet Key Exchange) key management protocols. Later, when the key rate of QKD devices increased, IKE could be abandoned and the use of OTP forced, which would lead to a highly secure network architecture.
The authors proposed the use of a QKD network between sensitive areas only, in which the QKD endpoints would be used to further distribute obtained information into private networks(enclaves). The QKD endpoints would have had the same function as border routers in standard IP networks. Connecting the end-user directly to the QKD network was never planned. The main idea was to create a storage “reservoir” at both ends of the corresponding QKD link that would be gradually filled with key material established through QKD. This keying material would later be used with an IPSec protocol suite and employed to encrypt virtual private network (VPN) tunnels.
When the traffic was received by the corresponding endpoint at the receiving end of the VPN tunnel, it would be forwarded to a final user located in the private network (enclave).
To simplify the process but also use the software of different platforms and manufacturers, the QKD endpoint was separated into two distinct computers. The first computer, called Optical Process Control (OPC), used the LabView software to control associated QKD equipment, while the other computer was used for IPSec communication, routing, network protocols, and QKD protocols (sifting, privacy amplification, etc.). These two computers used local 100 Mbps Ethernet connections. For synchronous data exchange, a specialized set of BBN-supplied UDP 6 protocols was used.

Another important issue was synchronization between these computers and synchronization between QKD and the VPN protocol suite. More precisely, solving the management of key material produced by optical devices was necessary. The procedure was as follows:

(1) The OPC computer delivers a fixed-size raw Qframe block of symbols transmitted through optical devices. It contains an indication of the bases that were used to encode the information in photons. These Qframe blocks are further processed by a QKD daemon with the QKD post-processing suite (sifting, QBER, privacy amplification, or similar), producing a Qblock as output.

(2) A Qblock is a fixed-size block of shared bits, each Qblock having its own 16-bit Qblock identifier (ID). Qblocks are stored in a storage reservoir of key material at both ends. These blocks are stored continuously, regardless of consumption.

(3) The IKE daemon uses Qblock IDs to establish a final key, which is then used by IPSec,since both ends have the same key material stored in their respective storage reservoirs.


5.1.3 IPSec Protocol Suite. Internet Protocol Security (IPSec) is a protocol suite for the purpose of ensuring the integrity, authenticity, and confidentiality of connections over the public internet. IPSec operates at the Internet Protocol (IP) layer and as a perimeter between protected and unprotected network interfaces by requiring a protection level. By default, IPSec uses the Internet Key Exchange (IKE) method for automatic keying. The basic concept of IKE protocol is simple and takes place in two phases. The first phase establishes an authenticated, bi-directional, secure link(the Internet Security Association) and the Key Management Protocol (ISAKMP) SA by exchanging random nonce and half-keys for the Diffie-Hellman key exchange. Authentication of a Phase 1channel is performed by exchanging messages encrypted with a session key. Random secret bits from Phase 1 that are used to establish ISAKMP are conventionally termed SKEYID. These bits are considered the most sensitive point in IKE points, since they are used as a partial input for creating Phase 2 SA keys and for protecting traffic through a given Phase 2 SA. Replacing these bits from time to time in order not to compromise the system’s security is therefore important.
The second phase uses SKEYID bits to negotiate the IPSec SAs between two gateways that carry message traffic for a certain VPN traffic flow. Each IKE security association has a maximum lifetime that limits the use of key material for the previously established association. These limitations can be defined in time (seconds) or in encrypted data (kilobytes) and are stored in SPD entry for a given SA. After the lifetime expires, a new SA must be negotiated with fresh key material. It is important to note that there is no standard for using OTP with IPSec. Various solutions have therefore been proposed, such as References [14, 48, 97].

The DARPA QKD Network employed IKE because at the time of its development (January 2002),IKE was the most widely deployed internet key agreement protocol. Two extensions exist that depend on a later-used type of cipher:

• The Quantum Perfect Forward Secrecy (QPFS) extension, which is based on the use of QKD techniques, for agreeing on secret keys employed as seeds for conventional symmetric ciphers such as AES or 3DES. Since the security of these symmetrical ciphers may be compromised in the following years, continual and automatic reseeding with fresh QKD bits is advisable. In the DARPA QKD network, AES keys were refreshed about once per minute [15] by omitting the Phase 1 negotiation and using QKD bits as a direct input to the IKE Phase 2. This solution increased the security of IPSec associations, since the keys were derived fromQKD instead of the Diffie-Hellman (DH) key exchange.

• An extension based on the use of QKD techniques for agreeing on secret key bits used with a one-time pad (OTP) cipher. This solution lowers the data rate to the QKD key rate, since the key material in the storage reservoir is charged only by QKD.
To implement the listed extensions, the DARPA QKD network team extended the IKE Phase 2 by adding an option to the QPFS extension that works in the same structural manner as a regular IKE Phase 2 PFS but uses QKD bits rather than bits obtained from the DH key exchange. The solution was implemented in Net BSD with the “raccoon” IKE daemon. The modifications included policy mechanisms to specify when and which extension should be used, with the possibility to specify values (re-key rates, cryptographic algorithms, keys, etc.) for each VPN gateway.

5.1.4 Routing in the DARPA QKD Network. A routing mechanism is required in situations when two nodes do not have a direct point-to-point QKD link between them and therefore need to agree on a path through a trusted repeater network.

Each node has a database of the full link state of the network. For each network node, it keeps the node’s ID and a list of neighboring nodes. DARPA modified well-known Open Shortest Path First(OSPF) routing protocol [98] to use the specific QKD networks metric [92]. The idea is that eachnode exchanges a certain number of bits with its neighboring node, thereby measuring the rate of exchange and the total number of bits exchanged (measuring the quality of the connection) [99].
Link quality is calculated using link metric m and stored in the database of the corresponding node: q > t, 100 + 1000q-t ,(1)m =,q < t,where q denotes the number of Qblocks expected to be available on the link in one Link State Announcement (LSA) update interval, m is the link metric, and t is the threshold (default value 5)for a minimum number of Qblocks to be maintained on an active link.
Later, when a route between distant nodes is requested, the route with the smallest total metricis selected. For the purposes of finding this path, Dijkstra’s algorithm is used. To refresh the records in link-state databases, periodic messages ROUT1LSA are exchanged [29]. These messages carry the node ID of the sending node, the node ID of the neighboring node, and the corresponding 32-bit link metric. ROUT1LSA messages are exchanged at every LSA update interval, which is a configurable parameter set to one minute by default. Each node has an individual LSA timer that does not depend on other nodes in the network.

However, it is evident that described modification of OSPFv2 protocol does not take into account the parameters of the public link. The metric m defined in Equation (1) only examines the amount of available key material, without considering other parameters such as link load or delay [99].
Routing protocols are discussed further in Section 6.

5.1.5 BBN’s Key Repeater Protocols for Trusted Networks. As noted above, a QKD network is used to overcome the limitations of the length of the QKD link. The DARPA QKD network laid the foundation for the Key Repeater Protocol and represents the first implementation of a Trusted Repeater QKD network. This implementation will be explained briefly here. More details can be found in Reference [29].
When two distant nodes in the QKD network (i.e., node A and node D) want to establish secure communication and no direct point-to-point link exists between them, they need to agree on a path through the network. This path is calculated with a routing protocol, and the nodes use a Key Repeater strategy to establish key material. The source node is always the node with the higher node ID. The source node (node A in Figure 7(a)) sends reservation requests to each node in the path (intermediate nodes) and to the destination (node D in Figure 7(a)). Each node in the path then negotiates with its predecessor for a Qblock (Figure 7(a)) and informs the source when the negotiation process has been successfully completed. If reservations are successful, the source requests a key from the destination and all the intermediate nodes. The intermediate nodes send the XOR of two Qblocks established with neighboring nodes, while the destination node sends the XOR of the previous hop Qblock and a new random Qblock n (Figure 7(b)). This Qblock n is the final key shared by source node A and destination node D.
From the above, it is obvious that BBN’s Key Repeater method of establishing key material takes time and requires the absolute trust of each node involved in communication. Authentication techniques therefore have a special significance in the entire process. As already discussed, the most effective way to circumvent compromised nodes is to use multiple independent paths.


5.1.6 Summary. The DARPA network was the first network to demonstrate QKD networking.
The performance achieved by this network (maximum distance of 29 km via the optical switch between Harvard and Boston Universities [91] and maximum key rate of 400 bps) is considered the basis for further QKD deployment. The system involved trusted repeater and switched QKD networking, demonstrating the advantages and disadvantages of both methods. A brief summary of the DARPA QKD network is given in Table 2.

However, the DARPA network was shut down in 2006, and no other field deployments by US government agencies have been reported since. In 2017, the Quantum National Initiative was announced, fueled by China’s successful launch of the “Micius” satellite [100, 101]. In 2018, the startup company Quantum Xchange announced plans for the first commercial quantum communication network “Phio” in the USA [102, 103]. Using its own exclusive trusted nodes, Quantum Xchange provides secure key transmission over long distances. This QKD network operates in Washington,D.C., and New York City, including the link connecting financial markets on Wall Street with data centers in New Jersey [104]. To achieve double network capacity, collaboration with Toshiba was announced [105].

\subsubsection*{SECOQC QKD Network}
In 2004, the European Commission’s (EC) integrated FP6 Project SECOQC (Secure Communication based on Quantum Cryptography) brought together 41 research and industrial partners from 11 European Union countries, Russia, and Switzerland. The main aim of the SECOQC project was to firmly define the practical application of QKD technologies and systematically treat the issue of QKD networks, including their security, design and architecture, communications protocols,implementation, demonstration, and test operation of QKD network protocols.
The SECOQC approach was to define QKD networks as infrastructure based on point-to-point QKD capabilities that aimed for ITS key agreement and secure communication [106]. Taking into account that the first results of the DARPA QKD network were available [92], SECOQC decided to further improve the trusted repeater QKD network type. The “Quantum Backbone” QBB network of metropolitan distance (6–85 km) consisting of seven fiber-bound key distribution links plus one short distance free-space link was deployed for testing purposes in Vienna [57]. Five nodes-SIE,BRT, GUD, FRM, and ERD-were located at the Siemens premises, and the STP node was hosted by a repeater station near St. Pölten on the communications line from Vienna to Munich, Germany.

5.2.1 QBB Links and Nodes. As shown in Figure 8, SECOQC integrated eight links belonging to six different systems:

• Attenuated Laser Pulse — a modified, commercially available “Cerberis” solution implemented by Swiss company idQuantique.

• One-way Weak Coherent Pulse system with decoy states — implemented by Toshiba UK.

• Coherent-One-Way — implemented by the N. Gisin’s team at GAP, University of Geneva.

• Entangled photons — provided by the Austrian Research Centers (ARC) and Royal Institute of Technology of Kista KTH, Sweden.

• Continuous Variables — implemented by the CNRS-Thales-ULB consortium from France/Belgium.

• Free Space link — developed by Ludwig Maximilian University of Munich, Germany.
All of these systems had to comply with the following requirements:

• A key rate greater than 1 kbps over 25 km of fibers (6 dB loss with a fiber attenuation of approximately 0.25 dB/km over standard telecommunications fiber).

• Autonomously deliver the key for more than six months without human interaction.

• A latency time of one minute for a new start-up. 

• All equipment used must fit into a standard 19" telecommunications rack.

• Each QKD-device must communicate with its peer over a standard interface provided bythe node module controlling the share management commands. 

SECOQC network included several different QKD solutions:

• The free space QKD system employed the BB84 protocol with decoy states, which resulted in a secure key rate of up to 17 kbps over 80 m between the ERD and FRM nodes.

• The idQuantique QKD system implemented the BB84 and SARG04 protocols using a commercial Cerberis system, which resulted in an almost equal value prescribed by the SECOQC criteria (1 kbps).

• Toshiba Research Europe Ltd (TREL) implemented a weak coherent pulse (WCP) decoy state plus vacuum state BB84 protocol and obtained a 5.7 kbps key rate over a fiber length of
25 km.

• A coherent One-Way (COW) System designed by GAP (Group of Applied Physics at the University of Geneva) achieved a novel distributed phase reference COW protocol, which can be seen as a BB84 modification with phase relations between pulses [28].

• The entanglement-based QKD (ENT) developed by an Austrian-Swedish consortium implemented BBM92 for entangled states between the ERD and SIE nodes over a 16-km fiber and provided a reliable key rate of over 2 kbps.

• The Continuous-Variable (CV) system was developed in cooperation between Charles Fabryde l’Institut d’Optique, THALES Research \& Technology France and University Libre de Bruxelles. Their system achieved a distribution rate of 8 kbps over a 6.2-km standard optical fiber (attenuation of the fiber was approximately 2.8 dB, while the length of an equivalent fiber with a loss of 0.2 dB/km would be 14 km).

SECOQC nodes followed the DARPA approach of storing key material in storage reservoirs.
Considering that the QKD links between nodes must be achieved in a point-to-point manner, anode needs to possess a dedicated QKD device for each connection to other nodes. Key material from QKD devices is first deployed in Pickup Stores. This temporary storage keeps the key material until it is confirmed that the same material is found in both QKD nodes forming the corresponding QKD link. After successfully confirming the existence of the same key material at both ends,the key material is then forwarded to a Common Store. There is only a single Common Store for the Q3P link (which can contain one or more QKD links between two nodes), and key material in this storage is uniquely identified by the key material block. When use of the key material is requested, keys are forwarded to In or Out key buffers and used for encryption or decryption purposes by a Crypto Engine. Organizing key storage in a described manner, QKD nodes can tolerate fluctuations in key consumption by buffering the generated key material. More details about KeyStore organization can be found in References [28, 106].

5.2.2 Hop-by-hop Message Transmission. The SECOQC network has laid bare the basics of the hop-by-hop approach to QKD network communication. This mode is known as the “Store \& Forward” technique and implies the use of a separate key for each link in the path. As shown in Figure 9, each node decrypts the message, verifies the authentication tag, and re-encrypts the message using a key that matches the connection to the next node. The procedure is repeated in each node on the path until the message reaches its destination [106].


5.2.3 Routing in the SECOQC QKD Network. SECOQC suggested using an IPv4 address structure and geographical division of the QKD network in multiple routing areas for the following reasons:

• A QKD network is a private network that has the freedom to use any available area of IPv4address space.

• Expecting a rapid and extensive spread of the QKD network is not reasonable. IPv4 address space should therefore be enough to address current and future nodes.

• The distance limitations of QKD links do not allow the QKD network to be divided betwee nthe backbone and an arbitrary number of autonomous systems. Treating all nodes in the network equally is therefore necessary.

• The current lack of quantum repeaters means QKD nodes must be seen as an access point for end-user applications, not just as forwarding nodes in the network.

To meet the requirements for addressing and routing, SECOQC proposed forming a node with the following components:

• Q3P modules responsible for link-level communication with other nodes.

• A routing module to collect and maintain routing tables.

• A forwarding module to create paths and make forwarding decisions.

• Other modules for node management, random session key generation, security monitoring,and so on.

The function of a routing module is to maintain a local table of routing information and informother nodes about updates in the network so they can also update their routing tables. Well-known routing protocols can be modified and used in the QKD network, but it is necessary to take into account the lack of a quantum repeaters, which means that each network node must be ready to receive traffic from its neighboring node and forward it along the best path to the requested destination (more details in Section 6). This is the forwarding module’s task. The module receive san incoming packet, checks the TTL value and authentication checksum, and depending on the results, decides either to forward or discard the packet.

In SECOQC, a modified version of the OSPFv2 protocol was used. It is interesting that OSPFv2does not support QoS routing, which is necessary to guarantee the required service type. OSPFv2was implemented with the aim of accelerating the development process [33]. In the standard OSPF,the forwarding decision is made based on the destination address and the shortest path information in the routing table. However, considering the low key rate of QKD links, other parameters must be taken into account when calculating the best path.


To compute the shortest path tree data structure, the Dijkstra algorithm is used. Each node calculates a unique shortest path tree and uses a modified version of the OSPFv2 to compute the routing table. The main difference is that the modified OSPFv2 calculates multiple paths to each destination instead of a single shortest path. Multiple paths are needed to fulfill the requirements of load balancing and spare paths. Each QKD node therefore computes as many routing tables as the number of its interfaces. OSPFv2 delivers periodic LSA messages to other nodes in the network with the aim of spreading information about the current state of the network.

Furthermore, each node computes an Extended Routing Table in which all costs in increasing magnitude to every other node are listed. This table is used to merge all routing tables in a single place. The table structure is similar to the standard routing table, the difference being that it has as many entries for each destination as the number of outgoing node links [33]. Now, the node can find multiple paths to the destination node, but it also needs to know an approximate load of selected links in the path. If the load of a link is greater than the calculated threshold, the next best link is looked up, and so on. The third Load State Database table is computed to store details about the approximate load of each outgoing link. It is used to verify whether the link has sufficient resources for transmitting the message [28]. The approximate load of the outgoing link i at discrete time t is denoted by L i (t ) and calculated using a low-pass filter with Equation (2):L i (t ) = 1 -(2)· L i (t - 1) + · l i (t ), where l i (t ) is the instant load of the outgoing link i and w is the filter constant. The instant load l i (t ) is calculated as a ratio of the number of transmitted bits in the previous unit time. More details about routing and forwarding modules can be found in References [33] and [28].


5.2.4 Summary. It should be emphasized that application development was not the SECOQC project’s task. SECOQC, however, conducted several experiments to test the solutions created. During the SECOQC QKD conference from October 8–10, 2008, a demonstration of telephone communications and video conferencing was given. A VPN tunnel was established between the nodes and AES encryption was used. The AES key was refreshed every 20 seconds, 9 and at certain moments, AES encryption was replaced by OTP [106]. The main objective was to test routing mechanisms, measure key material consumption and generation, and highlight basic mechanisms of the SECOQC network functionality. It is worth noting that SECOQC investigated the establishment of a QKD connection to the end-user [28].

The SECOQC network has laid the groundwork for a hop-by-hop networking approach that greatly simplifies views on implementing routing decisions. The hop-by-hop approach allows each node to decide which further path to direct the message, which offers more flexibility in implementing routing protocols. However, the BBN key-repeater approach described in Section 5.1.5,requires having a global, up-to-date view of the network before establishing and reserving resources on the path, which can be demanding due to the dynamic consumption of generatin gkey rates. The SECOQC network also demonstrated interoperability between different equipment manufacturers and showed that the QKD network could achieve ranges of almost 100 km (the maximum link length was 82 km between the BREIT and St. Pölten nodes) [37]. A brief summary of the SECOQC network is given in Table 3.

Interest in quantum cryptography in the EU has been accompanied by projects funded under the Quantum Technologies Flagship, Quant Era, COST, and EuraMet programs [107–112]. In 2019, the EU Horizont2020 project OPENQKD with a consortium of 38 partners from industry and academia was announced [113]. OPENQKD aims to lay the foundations for future European quantum infrastructure and the convergence of quantum technology with practical telecommunications systems in Europe within three years.
\subsubsection*{Tokyo UQCC QKD Network}
Two years after SECOQC, nine organizations from Japan and the European Union participated in the Tokyo UQCC QKD testbed network (“Japan Giga Bit Network 2 plus” - JGN2plus). The network consisted of parts of the National Institute of Information and Communications Technology of Japan (NICT) open testbed network called “Japan Giga Bit Network 2 plus” (JGN2plus) [38].
The Tokyo QKD network contained four access points, Hakusan, Hongo, Koganei, and Otemachi,and six nodes connected by commercial optical fibers installed at these access points (Figure 10).
Since half of chosen fibers were aerial, large losses occurred on the links. The link between the Kogenei and Otemachi nodes had a loss rate of about 0.3 dB/km, while on other links this rate reached even 0.5 dB/km.

Similarly to SECOQC, the project’s participants implemented certain network links, allocated as follows:

• A 24-km link between the Otemachi and Hakusan nodes was provided by the Mitsubishi Electric Corporation and NTT Company. They implemented the BB84 protocol with a maximum key rate of 2 kbps and QBER of 4.5%.

• A 45-km link between the Koganei and Otemachi nodes was provided by NEC, implementing the decoy state BB84 protocol with a NICT superconducting single photon detector(SSPD). The maximum key rate was 81.7 kbps with an average QBER of 2.7%.

• NTT used DPS-QKD on the longest link in the network, which was 90 km between the Koganei-1 and Koganei-2 nodes. They also used an SSPD detector and achieved a maximum key rate of 15 kbps with an average QBER of 2.3% [114].

• Three organizations from Austria, including the AIT, the Institute of Quantum Opticsand Quantum Information (IQOQI), and the University of Vienna, formed a single team called “All Vienna.” They presented their SECOQC QKD device. This device was based on entanglement of the QKD BBM92 protocol, which was placed between the Koganei-2 and Koganei-3 nodes with a maximum key rate of 0.25 kbps.

• Toshiba Research Europe Ltd. demonstrated their decoy-state BB84 system with selfdifferencing avalanche photodiodes (SPAPDs) between the Koganei-2 and Otemachi-2nodes on a 45-km link. The maximum key rate was a record 304 kbps with an averageQBER of 3.8\%. This was by far the highest sustained QKD bit rate produced to date.

• Finally, a 13-km link between the Otemachi and Hongo nodes was provided by idQuantique from Switzerland, making use of the SARG04 protocol from their commercial Cerberis solution. The maximum key rate was 1.5 kbps.

The Tokyo UQCC QKD network followed a similar three-layer network architecture based on the trusted repeater approach as it was implemented in the SECOQC project. The main difference was the use of a Key Management Server (KMS) for centralized management. The Tokyo QKD network attempted to test a government-chartered network scenario, which often has a central dispatcher or central data server. The KMS was installed in Koganei-1, Koganei-2, Otemachi-1, and Otemachi-2. All nodes implemented Key Management Agents, whose main task was to save the key material and store link statistical data, such as QBER and key generation rate. Later, these statistical data were forwarded to the KMS, which coordinated with all the links in the network [38].

5.3.1 Summary. In October 2010, a live demonstration of secure TV conferencing, eavesdropping detection, and QKD link rerouting on the Tokyo UQCC QKD network was performed. Layer
2-VPN encryption with OTP between the Otemachi-2 and Koganei-1 nodes was established. Two routes were used to demonstrate the routing algorithm when the links were attacked by the eavesdropper. The KMS detected the attacks because of an increase in the QBER and rerouted the communication through a spare link.

As noted in Table 4, the Tokyo QKD network showed that QKD technology can reach speeds of several hundred bits per second. The network also confirmed communication capabilities in QKDlink distance, achieving a record link of 90 km between the Koganei-1 and Koganei-2 nodes [58]. However, what sets this network apart is the introduction of a hierarchical view into the organization of QKD networks. The key management servers implement a management layer and have complete insight into the state of the QKD network in their domain. Organization in this manner has brought the QKD network closer to the SDN perspective discussed in Section 7.

\subsubsection*{QKD Networks in China}
China has been constructing QKD networks on a national scale. These efforts started by constructing testbed metropolitan QKD networks in Hefei, where a three-node network [115] and five-node network [71] were constructed in 2009 and 2010, respectively. Other efforts to construct fiber-based QKD networks have been reported in References [116–119], and a satellite-based QKD network is also being formed [24]. This section provides an overview of these developments by looking at some recently constructed fiber-based networks.

5.4.1 Beijing-Shanghai Backbone QKD Network. In September 2017, the 2,000 km Beijing-Shanghai backbone QKD network commenced operation [120]. To date, it is the longest QKD network in the world. The project is led by the University of Science and Technology of China(USTC). Other participants include China Cable Television Network Co., Shandong Academy of Information \& Communication Technology, Industrial and Commercial Bank of China (ICBC),Xinhua Financial Information Exchange, and others. The network was completed in September 2016 and was tested for one year before commencing operation.

The backbone network consists of 32 physical nodes linearly connected by QKD links(Figure 11). Among these nodes, Beijing, Jinan, Fuli, Hefei, Nanjing, and Shanghai are the access points, while the rest are trusted repeater nodes. The backbone network has 135 links in total.
Two to eight multiple QKD links lie between adjacent nodes. To conserve fiber resources, the network uses quantum wavelength division multiplexing technology, which combines four quantum channels into a single fiber. The network rents dark fibers deployed by China Cable Television Network Co. The distance between adjacent nodes along the backbone line varies from 34 km to
89 km, with fiber loss varying from 7.26 dB to 22.27 dB.
The backbone network deploys the QKD devices provided by QuantumCTek Co. The device implements a polarization-coding-based decoy state BB84 protocol. Some of the devices integrate the up-conversion single photon detection technique and thereby achieve a 25\% single photon detection rate.

The backbone network is designed to function as a high bandwidth channel that feeds quantum keys between metropolitan and QKD networks located in different cities. Up to now, the backbone network has been connected to the metropolitan QKD networks already established in Beijing,Shanghai, Jian, and Hefei. A wide area QKD network has been thus formed and provides end-users,including banks, government agencies, and large enterprises, with versatile security services [121].

In November 2018, an extension of the Beijing-Shanghai backbone network was completed by establishing a backbone QKD link between Wuhan and Hefei. The purpose was to connect the Wuhan metropolitan QKD network to the backbone network. The Wuhan-Hefei backbone line is operated by CAS Quantum Network Co. In the long term, the backbone network will be further extended to cover a wider area of China.

5.4.2 Jinan Government Private QKD Network. The Jinan government private QKD network commenced construction in April 2017 and was completed in August 2017. The network covers an 8,000 km 2 area of the city and consists of 32 nodes, including a centralized control station node, eight trusted repeater nodes, and 23 end-user nodes. QuantumCTek Co., Ltd provides the QKD systems and the network design solutions, while China Union Shandong Branch provides the fiber resources [122, 123]. The network has 33 QKD links in total (Figure 12). The length of the links varies from 1.7 km to 64.7 km, with the fiber loss varying from 1.48 dB to 25.2 dB. The quantum signals are transmitted through dark fibers provided by China Union Shandong Branch.
The network deploys QKD systems implementing the polarization-coding- based decoy state BB84protocol. All systems are provided by QuantumCTek.

The network adopts a salable, self-built service channel, which provides secure data transmission services and a minimum bandwidth of 512 Mbps. The Jinan private network integrates VoIP telephone and video conferencing services supplied with quantum keys. The security service is accessed through repeaters that implement an IPSec VPN protocol supplied with quantum keys.
The network supports the OTP and several other symmetric encryption algorithms. The typical key refresh rate of symmetric encryption algorithms is once per second [124].

5.4.3 Wuhan Metropolitan Area QKD Network. The Wuhan metropolitan area QKD network was constructed in 2017 from January to December. The network consists of one command center,one centralized control station, 10 trusted repeater nodes, and 60 end-user nodes (Figure 13).

The network has 74 QKD links in total. The centralized control station and two central trusted repeater nodes are interconnected to form a network ring. Their connections adopt a dual-link structure (two QKD links are established between every other node). The longest QKD link was 16.5 km, and the optical channel loss incurred by the fiber, WDM device, and optical switch was a maximum of 14.6 dB over 6.7 km. This high loss largely results from the complex metropolitan fiber environment. The key rate of the QKD links ranges from 2.8 kbps to 141 kbps. The QKDsystems are provided by QuantumCTek [125].

One of the network’s features is classic quantum WDM technology [126], which integrates the classic service signal, quantum signal, and classic QKD post-processing signal into a single fiber. The security service is accessed via an encryption repeater that implements an IPSec VPN protocol supplied with quantum keys. The typical key refresh rate of the symmetric encryption algorithmsis once every five seconds.

5.4.4 Hefei, Chaohu, and Wuhu Wide Area QKD Network. A QKD wide area network connecting the cities of Hefei, Chaohu. and Wuhu (HCW) in China was reported in 2014 in Reference [119].
The entire HCW QKD network, which has a complete technical description available, operated for more than 5,000 hours from 21 December 2011 to 19 July 2012 and was installed in the Anhui provincial telecommunications network of China Mobile Ltd., with over 150 km of coverage area.

Thirteen QKD devices over nine nodes were employed in this network [119]. The HCW wide area network consists of two metropolitan networks: the Hefei QKD network, which has five nodes [116, 117], and the Wuhu QKD network [118], which has three nodes. These two networks were connected with an intercity QKD link, which combined Hefei and Wuhu metropolitan area QKD networks through a trusted repeater node at the Chaohu Branch of China Mobile Ltd. [119].

The network deployed QKD systems that implement the phase-coding-based decoy state BB84protocol. The maximum key rate in the HCW QKD network was 16.15 kbps between the West Campus and North Campus nodes over a 3.1 km link connected to an optical switch located in the Campus Library [119].

5.4.5 Networking Strategies. The Beijing-Shanghai backbone QKD network and several other metropolitan area QKD networks employ a number of networking strategies to improve the performance and robustness of the network:

• Some metropolitan area networks adopt a ring topology in the network’s design to improve its disaster tolerance.

• Backbone connections adopt a multiple parallel link networking strategy to improve bandwidth and the network’s stability.

• Some core nodes such as the centralized control stations deploy backup devices that reduce the probability of system service interruption caused by a single point of failure.

5.4.6 Network Key Routing. Key routing in the Beijing-Shanghai QKD backbone network, Jinan government-private QKD network, and Wuhan metropolitan area QKD network uses a client server architecture to maximize channel utilization and provide on-demand quantum keys to end-users.
The centralized control station of each network implements a key routing server that is in charge of managing the routing table for each network node. Based on information collected from the network (the running status of the QKD links, the remaining key storage capacity, and other information), the routing table of each node is periodically updated. The updated routing tables are exchanged with other network nodes to provide information about suitable paths until the next update [127].

The key routing server supports multiple queuing strategies adapted to different network topology structures. In the case of an emergency fault, such as the failure of the key management machine or unavailability of the key, the node device actively reports the event to the routing server.
The server then recalculates routing tables for affected nodes. In the Beijing-Shanghai backbone network, key routing is managed by dividing the network into multiple sub-networks. Each subnetwork adopts the above client-server structure with the key routing server located at the access nodes [127, 128].

5.4.7 Summary. With a 2,000-km link connecting Shanghai and Beijing and metropolitan networks in Hefei and Jinan, China is currently leading the QKD race in terms of practical developments [129]. In their described methodologies, unique approaches in implementing existing and available technology can be seen in these QKD networks. However, in addition to using discrete QKD protocols that guarantee high performance but require expensive single-photon detectors,experiments that rely on continuous-variable and measurement-device-independent (MDI) QKD have also been reported. For CV-QKD, results of 5.77 kbps over 50 km have been achieved [73, 130]. The experiments with MDI-QKD have resulted the higher rates (up to the channel attenuation): 98.2 kbps over 49.1 km and up to 1 Mbps over a dozen kilometers’ distance [131]. Moreover, QKD systems based on MDI can work efficiently not only in symmetric channels with similar losses,but even with channels with asymmetric losses [132]. The optimization methods [133] can extend the secure transmission distance in such MDI-QKD implementations by more than 20–50 km in standard telecom fiber. A brief summary of the networks described above with publicly available references is listed in Table 5.

Not discussed here for reasons of space, it is, however, important to mention that China is leading in the field of space-oriented quantum technology. In 2017, the 640-kg “Micius” satellite was launched [134]. In a 273-second satellite pass and using a 1-m telescope on the ground, sifted key rates of about 12 kbps at 645 km to 1 kbps at 1,200 km were expected [135]. After post-processing, 1.1 kbps for the secure key was obtained.
6
\subsubsection{QUALITY OF SERVICE IN QKD NETWORKS}

Similarities between QKD and Mobile Ad Hoc Network Technologies. The specific QKD issues and constraints described above pose significant challenges in QKD network design. However, analysis of the characteristics of QKD networks has shown similarities in Reference [136] to Mobile Ad Hoc Networks (MANET) and Vehicular Ad Hoc Networks(VANET) [137–139].

The main characteristics of QKD technology from a simple point of view can be listed:

• QKD links such as those described above are always implemented in point-to-point behavior and can be roughly characterized by two features: limited distance and key rate(exponentially) decreasing with distance. Links may become unavailable when there is note nough key material or when the public channel is congested. This is similar to Wi-Fi links,which are limited in range and whose communication speeds depend on the user’s distance from the transmitter’s antenna.

• One of the main features of current QKD networks is the lack of a quantum repeater (Section 3.2), and communication is therefore usually performed on a hop-by-hop basis.

In MANET networks, communication takes place on a hop-by-hop basis, and mobile nodes are typically powered with energy-aware solutions such as batteries. The nodes connect themselves in a self-organizing, decentralized manner with no authority in charge of controlling and network management. The main drawback of MANET networks is the unpredictable mobility of nodes,which can often lead to unstable routing paths [114]. The amount of battery power and the mobility of MANET nodes can be easily linked to the amount of key material in QKD key storage. The limited range of wireless links is much like the limitations in the length of a QKD link. The lack of dedicated network infrastructure (such as routers) is another similarity between these two technologies. The poor mobility of QKD nodes, however, makes it similar to VANET technology,in which communication takes place along a predefined path.

Although at first glance MANET and QKD networks have nothing in common, a simple analysis of the features of these networks reveals their similarity. What clearly distinguishes these two networks, though, is their purpose. MANET networks are designed for fast and straightforward communication in situations where pre-existing installed infrastructure is not available (e.g.,search-and-rescue operations during natural disasters or in war zones). By contrast, the primary goal of QKD is to provide ITS communication. This may have a significant impact when choosing network solutions, since a solution required in one situation may not be suitable in another. For example, consider routing solutions based on network flooding. QKD networks rely on the assumption that all nodes are trusted when communication is performed in a hop-by-hop or key repeating manner [32, 39], and by following this assumption strictly, an eavesdropper is restricted to attacking QKD links only. Because of the nature of QKD, the eavesdropper is not able to gain any information about the key being transported through the link, but service may be denied to disable the communication. Although results have been obtained by combining multiple paths to establish secure key material [27, 82], it is thought that the amount of routing information being sent to the nodes should be reduced to a minimum. To prevent a denial-of-service attack, no node(except source and destination) in a network should know the routing request. Therefore, the number of broadcast packets should be minimized. Furthermore, considering the primary objective of QKD, which is to provide ITS communication, routing packets must be either authenticated and encrypted or at least authenticated [140]. This means that the number of routing packets in the network needs to be minimized (routing overhead) concerning the material to be preserved for the protection of data, which is the primary goal of secure communication. From this, it follows that protocols based on flooding are not preferred in QKD networks.
\subsubsection*{Routing Protocols}
In previously deployed QKD networks, emphasis was placed on quantum channels. The public channel, though, was largely neglected and assumed that it was somehow achievable without any difficulties. The prioritization of network traffic and signaling protocols were ignored, and the solutions in existing conventional networks have consequently been modified for the needs of QKD networks. The first such solution, which is based on modifying the well-known Open Shortest Path First (OSPF) routing protocol [98], was implemented in the DARPA BBN QKD network builtin 2004 in the US [92]. Instead of using the routing hop-count metric, a modified OSPFv2 protocol was used to determine link quality according to the amount of key material in key storage. As discussed in Section 5.1.4, the modified version of the OSPFv2 does not take into account the status of the public channel [99].

A similar approach was offered in Reference [141], where the author proposed using unencrypted and non-authenticated communication to disseminate OSPFv2 routing packets. Obviously,this kind of network is easy prey for an eavesdropper with unlimited resources at their disposal,especially in terms of passive eavesdropping [76]. Since the described solution is based on the use of key material in key storage as a routing metric, it cannot provide efficient routing because of alack of information about the state of the public channel.

In the SECOQC network, another modified version of the OSPFv2 protocol was introduced [28,
33]. It was based on a local load-balancing policy calculated as the ratio of the number of transmitted bits over a period of time. As discussed in Section 5.2.3, a solution such as this does not consider the available amount of key material, which means that the algorithm may choose a path with insufficient key material for data transmission.

When the Chinese HCW QKD network was developed, a Quantum Key Reservation Approach(QKDRA) based on the IntServ model was applied [142, 143]. OSPFv2 is used to find the path from the source to the destination node. After the path is determined, the source node issues a key reservation request to all nodes in the path. After receiving a request, the intermediate node responds with a key reservation result message. Finally, the destination node determines the possibility of establishing the connection. Since OSPFv2 focuses on finding the shortest path,hence the name, solutions presented in References [142, 143] find the shortest path between the source and destination and reserve a sufficient amount of key material on a selected path. Note that this path may not be optimal. More specifically, the path is the shortest, but it may not bead equate in terms of QoS. It is known that minimum hop-count (shortest) routing typically finds routes with a significantly lower throughput than the best available [144], since it does not consider other link parameters. OSPFv2 in its original form does not consider QoS constraints; therefore,it cannot guarantee that traffic on the selected path will be adequately served. Reservation of resources on the quantum channel, in this case, does not provide a gain, since the path for the public channel may be inappropriate. However, even an extended version of OSPFv2 that includes QoS constraints [145] may not be optimal for QKD networks. Implementation of OSPFv2 in this way can find the path that has the best characteristics of the public channel but does not consider the parameters of the quantum channel.
Yang proposed using the Dijkstra algorithm to identify multiple paths but without considering the status of the public channel [146]. The idea is to use thresholds to exclude links that have a lower key material amount and periodically flood routing details, such as the amount of available key material.

The impact of public channel states on the key rate can be found in Reference [147]. This study shows that a public channel should not be excluded in route calculations, since the performance of the public channel affects the quantum channel and vice versa. Therefore, novel metrics are introduced to uniquely describe the state of the public and quantum channels as well as the overall QKDlink [147, 148]. With the aim of minimizing key consumption, network flooding should be avoided and a single-layer network organization and Greedy Perimeter Stateless Routing Protocol for QKD networks (GPSRQ) was introduced [136]. The GPSRQ routing protocol uses distributed geography and reactive routing to achieve high-level scalability. It is equipped with a caching mechanism and detection of returning loops, enabling forwarding while minimizing key material consumption. However, GPSRQ applications are limited to planar topologies only, because geographic routing in networks with non-planar topologies are not able to quickly determine the shortest path, leading to unnecessary forwarding and increased consumption of scarce key material.

Routing in QKD networks depends primarily on the architecture of the network organization(hierarchical or distributed architecture, overlay or single stack network, hop-by-hop or key repeater networking). Unlike conventional networks, routing solutions in QKD networks need to take into account both channels of the QKD link. Based on the requirement to minimize key consumption, it is necessary to reduce the amount of routing packets that have to be encrypted and authenticated or at least authenticated to avoid active and passive eavesdropping QKD network attacks [28, 140].

Considering the efforts to extend the QKD network to metropolitan areas, which involves a significant number of network nodes, a hierarchical organization was considered in previously implemented networks [42, 125, 149–151]. This approach, which is based on a key management layer, converges to a software-based network paradigm and is discussed in more detail in Section 7.

\subsubsection{QKD SOFTWARE DEFINED NETWORKING}
A more evolutionary strategy for adopting QKD in transport networks is taking advantage of the latest developments in networking technologies, more specifically, in network management.
Software-defined networking (SDN) [152, 153] allows the control (management) and data (forwarding) planes to be separated. Its popularity has increased in both academic and industrial spheres since its creation in 2008. SDN allows the integration of new technologies and services at a faster pace while enabling centralized management and optimization based on network programmability and configure ability principles. Although the approach for SDN has changed over they ears from OpenFlow-based device programmability towards open and standard interfaces, this transformation has helped network operators increasingly adopt SDN in their systems to reduce the time-to-market and vendor lock-in.

An SDN network is conceptually organized into three layers. The control and management layer knows the status of the entire network and can optimize its behavior through a centralized entity known as the SDN controller. The controller identifies the capabilities of the devices installed in the infrastructure layer through a set of standard mechanisms (southbound interface). It also knows the requirements of the different applications running in a network through standard interfaces (northbound interface). Its role is to optimize resources and provide the means for devices and services to fulfill their tasks. A QKD system installed in infrastructure can export its requirements to the controller so it can create a specific path with the required optical characteristics(i.e., maximum tolerated noise, attenuation, etc.) to connect the emitter to the receiver (either on a single or multi-hop path) and satisfy an application’s requirements. This allows an unprecedented means of creating a fully integrated classic/quantum network and genuinely zero-configuration QKD devices that can be directly plugged into a standard telecommunications network.

Before this technology, demonstrations required either an ad-hoc, separate network just for the quantum channel (i.e., typically a network of dark fibers) or specific network modifications for each link [154, 155]. These are very expensive and entirely orthogonal deployments for common telecommunications activities, in which devices are expected to work out of the box and share the fiber with many other conventional communications channels. For QKD to become mainstream, it is critically important that QKD systems follow the trends and architectures used in the transport network segment.

Other projects and demonstrations have shown initial steps towards automating QKD networks.
In References [156, 157], the authors implemented a mechanism for automating the switching of a quantum channel between a transmitter and two simulated receivers using optical cross-connect switches that were OpenFlow-enabled. In this sense and despite the enabler, in this case, being a software-defined optical network (SDON) controller, the research focused more on applying secure virtual machine migrations in a distributed data center scenario.
The most advanced contribution towards Software-Defined QKD Networks was presented in References [158–160] (Figure 14(b)). Three production sites in the Telefonica in Spain network were connected. The proposed architecture and demonstrations aimed to demonstrate the technological maturity of QKD systems for integration into production networks. The CV-QKD systems used for the trial were implemented so they could be managed and optimized with software processes and were robust enough to coexist with traditional communications channels. The software integrated the first version of an SDN interface defined by the Industry Specification Group (ISG) for QKD at the European Standards Telecommunications Institute (ETSI). With this interface, the QKD systems and the key delivery processes are centrally managed by an SDN controller, allowing quantum channels (via optical switches) to be dynamically instantiated, multi-hop associations to be created, and demands for keys from external applications to be identified. This setup was also designed so any control and data channel could integrate QKD-derived keys to secure communications related to either the QKD network or traditional telecommunications services running in the production network.

QKD can also be seen as an additional security layer for transport networks. The integration of QKD in SDN is a mutually beneficial relationship, since QKD-derived keys can be used to secure the different layers of a transport network. Apart from the demonstration conducted in Reference [157] in which the encryption algorithm (AES) was used to provide security, the authors in Reference [161] showed how existing security protocols used in the control plane could integrate quantum cryptography in a seamless evolutionary manner without affecting current schemes. Being composable in both cryptosystems (QKD and traditional or even post-quantum schemes), the security of the proposed system brings the best of both: certification from traditional schemes is still applicable to the hybrid system, while the security of the resulting solution is the highest possible, because breaking the final key means both cryptosystems must be compromised. This solution is deployed in control channels orchestrating an SDN controller and a network function virtualization (NFV) architecture through SSH and TLS protocols.

The SDN-based experiment of monitoring and mitigation of physical layer attacks was reported [162]. Real-time monitoring of QBER and the secret key rate was used to recalculate routes for the quantum channel establishment.
Other cases have focused more on data plane security and service establishment. Marksteiner presented an integration of QKD-derived keys in IPSec channels, focusing its research on the security and scalability of the solution depending on the service throughput [163]. In addition to this research, the approach reported in Reference [164] focuses on service automation for encrypted channels in an end-to-end network. Automation was suggested for data center scenarios (implementing extensions in OpenFlow) and for transport segments (using MPLS and NETCONF for configuration). This was integrated into virtual network functions implementing the extensions and the security channel using IPSec, as in Reference [163]. Mavromat is demonstrated the usage of QKD for energy-efficient SDN management of Internet of Things devices [165].
We also point out experiments with the use of SDN to control the WDM organization of QKDlinks [156, 166–168] as well as the use of machine learning (ML) models for the prediction ofCh-QKD quality in QKD-DWDM networks with increasing efficiency of SDN-enabled optical networks [169].

In a broad QKD network where multiple QKD tenants share the same underlying infrastructure,addressing the secure-key assignment is essential for efficient network managment. Cao proposed the SDN-based secret-key rate sharing approach using heuristic algorithm using simulations [170].
The multi-tenant organization can be served using Key as a Service (KaaS) approach where key pools (KP) defined at the control layer of SDN hierarchy mapped to virtual key pools using RESTful API at the application layer.
These results show how SDN must be seen as a technological enabler for QKD’s integration into transport networks. At the same time, QKD also benefits the network, since it implements an additional ITS layer for critical infrastructures. This integrative approach allows QKD systems to be smoothly integrated into the network and for QKD to be commercialized at different service levels (self-healed network infrastructures, end-to-end services at different OSI layers, etc.).

\subsubsection{CONCLUSION}
Quantum cryptography is an attractive cryptographic technology that has received the attention of various organizations in academic and industrial communities. In recent years, notable progress in the development of optical equipment has been reflected through a number of successful demonstrations of QKD technology. These demonstrations show great achievements in quantum cryptography and highlight the practical difficulties that still need to be resolved.
We provide a summary of the major key points related to QKD networks in Table 6. Trusted repeaters are necessary to extend the secure transmission distance of quantum channels. Solutions for integrating QKD networks into existing optical communications networks are currently the hot topic in optical research. Real quantum cryptography networks employed by end-users for real-life information transfer applications will be the next milestone. In terms of the industry,standards for security evaluation, production, and application of QKD are already being defined[189, 190].

Currently, a person finding himself in a QKD laboratory and asking for the maximum achievable key rate will receive a response with a question about the distance she/he is looking to cover.
As mentioned in Section 3, one of the main drawbacks of QKD links is length limitations. However, the networks discussed in this document demonstrate the significant development in optical equipment in recent times. In 2002, QKD systems achieved a key rate of 1 kbps [29], which was used in the DARPA QKD network. In 2007 in SECOQC, this key rate increased tenfold [37], while in 2011 in the Tokyo QKD network, a key rate of 300 kbps was achieved [38]. This key rate was sufficient to establish a video conference secured with an OTP cipher provided by QKD. It is also interesting to compare the length of links in these networks. The maximum length in the DARPAQKD network was a 29-km connection via the optical switch between Harvard and Boston Universities [91]. In SECOQC, the maximum length of the QKD link was 82 km between the BREIT and St. Pölten nodes [37]. In Tokyo, the maximum distance was a record 90 km between the Koganei-1and Koganei-2 nodes [171]. In Hefei-Chaohu-Wuhu (HCW) in China, the maximum distance was
85.1 km via the HCW intercity link between Hefei and Chaohu [119, 191].
It is reasonable therefore to expect a higher key rate and longer distances in the coming years.
Since optical quantum repeaters are predicted to become available for practical use in the future [57], QKD networks are currently implemented solely through the Trusted Repeater Approach(TRA). TRA is essential for overcoming the distance limitations between QKD links and in providing routing in QKD networks. TRA, however, has several restrictions that will have to be resolved if a QKD network is to be applied in everyday life and integrated with conventional IP networks.
One means for widespread application of QKD technology is integration with telecommunications networks using an approach such as SDN-QKD.

\subsection{\trnas}

\subsubsection*{Аннотация}
Сближение квантовой криптографии с приложениями, используемыми в повседневной жизни, является темой, привлекающей внимание промышленного и академического мира. Развитие квантовой электроники привело к практическому достижению квантовых устройств, которые уже доступны на рынке и ждут своего первого применения в более широком масштабе. Одним из основных аспектов квантовой криптографии является методология квантового распределения ключей (QKD), которая используется для генерации и распределения симметричных криптографических ключей между двумя географически разделенными пользователями с использованием принципов квантовой физики. В предыдущие годы было создано несколько успешных сетей QKD для проверки реализации и совместимости различных практических решений. В данной статье проводится обзор ранее применявшихся методов, показываются приемы развертывания QKD-сетей и текущие проблемы создания QKD-сетей. В отличие от исследований, посвященных оптическим каналам и оптическому оборудованию, данный обзор фокусируется на сетевом аспекте, рассматривая организацию сети, протоколы маршрутизации и сигнализации, методы моделирования и программно-определяемый подход к созданию сети QKD.


\subsubsection{Введение}
Установление безопасных криптографических ключей через недоверенные сети является одной из самых фундаментальных криптографических задач [1]. Хотя использование инфраструктуры открытых ключей, основанной на вычислительно сложных математических задачах и предположениях о вычислительной мощности подслушивающих лиц, преобладает, они относятся к группе теоретически разрушаемых решений вычислительной безопасности.
Поэтому они находятся под угрозой, поскольку вычислительная мощность продолжает расти и появляются алгоритмы квантовых вычислений, которые могут решить некоторые широко используемые вычислительно сложные математические задачи за полиномиальное время [2, 3]. Квантовое распределение ключей, известное как QKD [4], основано на принципах квантовой теории информации и позволяет устанавливать информационно-безопасные криптографические ключи, которые не зависят от этих ограничений, по крайней мере, на уровне протокола. Для этого схема аутентификации сообщений, такая как схема Вегмана-Картера [5], должна быть объединена с QKD [6, 7].
QKD-сети значительно отличаются от традиционных телекоммуникационных сетей из-за специфики QKD-соединений и организации сети. Такие ограничения, как ограниченная скорость генерации ключей и достижимое расстояние (раздел 2), отсутствие квантовых ретрансляторов (раздел 3.2), специфическая маршрутизация из-за использования публичных и квантовых каналов в квантовых каналах (раздел 6), а также организация сети, в которой на данный момент используется подход передачи ключей по принципу hop-by-hop (раздел 5.2.2), являются мотивами для данного обзора. Хотя можно найти несколько работ по сканированию QKD-соединений и квантовых каналов QKD [8-10], данный обзор посвящен QKD-сетям, организации сетей, протоколам маршрутизации и сигнализации, а также программно-определяемым методам QKD-сетей. После прочтения этого обзора заинтересованные читатели получат представление о квантовых сетях с инженерной точки зрения и будут знакомы с режимами функционирования, реализацией, существующими решениями и методами моделирования квантовых криптографических сетей. Данный обзор дает высокоуровневое представление о QKD-сетях и будет полезен и интересен исследователям, практикам, занимающимся проектированием QKD-сетей, и аспирантам в области прикладной квантовой криптографии.
Обзор организован следующим образом: В разделе 2 представлены особенности QKD-соединений. В разделе 3 кратко описаны ограничения и основные характеристики QKD-сетей, а также объясняется, как они практически реализуются. Типы QKD-сетей описаны в разделе 4. В разделе 5 рассматриваются ранее развернутые QKD-сети. В разделе 6 обсуждаются методы маршрутизации QKD-сетей. В разделе 7 представлен обзор программно-определяемых сетей QKD. Раздел 8 завершает данный обзор.

Обзор включает дополнительный материал с перечислением дополнительных сетей QKD в Разделе 1 и методами моделирования, обсуждаемыми в Разделе 2. Обзор протоколов сигнальных сетей приведен в разделе 3, а инкапсуляция QKD-заголовков и QKD-пакетов обсуждается в дополнительном материале, разделе 4. В разделе 5 представлен обзор работы в процессе стандартизации QKD.
%Графическая схема структуры исследования показана на рисунке 1.
\subsubsection{QKD связи}
QKD-связь, или просто "связь", обозначает логическое соединение между двумя удаленными QKD-узлами, соединенными квантовым каналом, используемым для передачи фотонов, и публичным каналом, используемым для постобработки обмениваемой информации, соответственно. Недостаток этого типа связи выражается в ограниченной скорости генерации ключей квантового канала, доступной сторонам, соединенным прямым оптическим волокном или свободной прямой видимостью в режиме "точка-точка" (P2P) на определенном расстоянии.
Однако это также является необходимым условием для безопасной генерации ключей.
Хотя оптоволокно является хорошей и широко используемой средой для передачи кубитов, установка выделенного оптического канала для целей QKD не является практичной во всех обстоятельствах. 1 Иногда удобно использовать канал связи в свободном пространстве, хотя он имеет свои недостатки, поскольку требует подходящих атмосферных условий, пути видимого света и приемлемого отношения сигнал/шум (SNR), что строго ограничивает время использования. Тем не менее, результаты, полученные в ходе экспериментов в Лос-Аламосе [17] и Мюнхене, в которых была установлена связь между землей и самолетом, летящим со скоростью 290 км/ч [18], продемонстрировали перспективность спутниковых соединений [17-23]. После проведения ряда экспериментов по ККД в свободном космосе и на земле, Китай успешно запустил квантовый спутник "Micius", который продемонстрировал ККД со спутника на землю на расстоянии от 645 до 1200 километров [24].
Максимальное расстояние, на котором может быть сгенерирован ключ, уменьшается с увеличением потерь и шума оптического детектора. Для данного детектора и настроек, скорость темного счета детектора постоянна, но скорость ключа уменьшается с расстоянием из-за увеличения кумулятивных потерь. В современных коммерческих оптоволоконных системах расстояние QKD-канала примерно ограничено 100 км, а скорость передачи ключей - несколькими десятками или сотнями [26, 27]. Из-за ограниченной скорости передачи ключей хранилище ключей устанавливается в обеих конечных точках соответствующей линии связи. Это хранилище постепенно заполняется новым ключевым материалом, а имеющийся ключевой материал впоследствии используется для шифрования/дешифрования потоков данных [28].
Объем данных, подлежащих шифрованию, и тип алгоритма шифрования определяют скорость разрядки хранилища ключей, или, проще говоря, скорость потребления ключей. Скорость использования ключей звеном иначе называется скоростью зарядки ключей [28-31]. QKD-соединение может быть обозначено как "в настоящее время недоступное", когда в хранилище ключей нет доступного ключевого материала, так как никакие криптографические операции не могут быть выполнены [32]. Стоит также отметить, что, по-видимому, оптимальной стратегией для QKD-устройств является непрерывная генерация ключей с максимальной интенсивностью до полного заполнения хранилища (что зависит от способа реализации) [28, 33].
Ключ может быть использован для шифрования связи по публичному каналу с помощью шифра One Time Pad (OTP) и схемы аутентификации ITS, такой как Wegman-Carter [34, 35]. Поскольку для шифра OTP требуется такое же количество ключа, которое соответствует длине шифруемого сообщения, и дополнительные ключи для аутентификации ITS, этот подход потребляет больше ключевого материала, чем передаваемое сообщение. Если ключевого материала недостаточно, OTP не может быть использован, и наиболее распространенным выбором является использование альтернативных криптографических методов, таких как Advanced Encryption Standard (AES), который не требует такого большого расхода ключей [36].

\subsubsection{QKD сети}
Сети QKD используются для расширения диапазона действия систем QKD и состоят из статических узлов, которые представляют собой безопасные точки доступа, считающиеся имеющими неограниченную вычислительную мощность и источник питания. Из-за того, что каналы, соединяющие узлы, работают по принципу "точка-точка", ранее развернутые тестовые площадки [29, 37, 38] показали, что защищенные ключи в сетях QKD могут передаваться от узла к узлу по принципу "хоп-хоп" (раздел 5.2.2) или через концепцию ретранслятора ключей (раздел 5.1.5).
Общим для обеих сетей является предположение, что все узлы в сети должны быть доверенными[32, 39]. Этого предположения можно избежать, если использовать методы квантового сетевого кодирования для многопутевой связи [40]. В этом обзоре кратко рассмотрены ранее развернутые сети QKD, сфокусированные на методах связи, протоколах маршрутизации и организации сети.
Чтобы облегчить организацию, сеть QKD часто описывается с использованием нескольких уровней[41, 42]:
- Квантовый уровень, на котором устанавливается защищенный симметричный ключ.
- Уровень управления ключами, используемый для проверки и управления ранее установленным ключом.
- Уровень связи, на котором установленный ключ используется для защиты трафика данных.
Как упоминалось выше, QKD является примитивом согласования ключей и как таковой находится на самом нижнем (базовом) уровне архитектуры сети QKD. Принимая во внимание различные скорости потребления ключевого материала различными приложениями, ситуация, в которой недостаточно ключевого материала для удовлетворения потребностей более высоких уровней, нежелательна. Поэтому квантовый уровень должен постоянно создавать ключевой материал. Чтобы обеспечить гарантированный уровень обслуживания, сеть QKD должна иметь детальное представление о своих ресурсах и возможностях. Ранее развернутые сети QKD не имели определенных стратегий для обеспечения качества услуг. Например, сеть SECOQC QKD, рассмотренная в разделе 5.2, придерживалась базового типа сервиса Best Effort, который определяет только среднюю ключевую скорость и разрыв трафика, в то время как тип сервиса Guaranteed Key Rate был предложен для улучшенных версий сетей QKD [33].
Учитывая наличие исчерпывающей и подробной документации по квантовой оптической связи [26, 43-47], акцент в данной публикации сделан на двух верхних уровнях. Эти уровни могут иметь различную и независимую сетевую организацию, поскольку связь между узлами осуществляется через существующие стандартные соединения, такие как Интернет, куда может быть включено произвольное количество промежуточных устройств (Рисунок 2). Уровень управления ключами отвечает за управление ресурсами хранения ключей, протоколами маршрутизации, качеством обслуживания (QoS) и так далее. Самый верхний коммуникационный уровень использует ранее созданный ключевой материал для шифрования трафика данных с помощью существующего набора протоколов безопасности, таких как Internet Protocol Security (IPSec) [14, 48].Однако описанная иерархия распределяет ответственность за безопасность между всеми тремя уровнями.
\subsubsection*{Атрибуты сети QKD}
QKD представляет собой новое поколение решений в области безопасности, которые не полагаются на вычислительные предположения проблем, считающихся сложными. Однако сети QKD должны быть интегрированы в существующую среду и должны соответствовать определенным критериям и условиям. Некоторые из наиболее распространенных требований к сетям QKD перечислены ниже.
3.1.1 Скорость передачи ключей. Одним из жизненно важных параметров, описывающих сеть QKD, является средняя скорость передачи ключей по каналу QKD. Поскольку операции шифрования и дешифрования не могут быть выполнены без достаточного количества ключевого материала, конкуренция между скоростью хранения ключевого материала в хранилище ключей и скоростью его потребления для операций шифрования и дешифрования оказывает большое влияние на производительность сети.
Сравнивая ранее развернутые сети QKD и испытательные стенды в хронологическом порядке, можно заметить быстрое улучшение в развитии квантового оборудования. Системы QKD, реализованные в 2002 году в сети DARPA QKD, могли достичь скорости передачи ключей около 400 бит/с на расстоянии 10 км [29]. В 2007 году в SECOQC максимальная ключевая скорость составила 3,1 кбит/с на расстоянии 33 км [37]. Лучшие решения, представленные в Токио в 2009 году, достигли ключевой скорости 304 кбит/с на расстоянии 45 км [38]. В 2017 году в Китае была построена магистральная QKD-сеть Пекин-Шанхай протяженностью 2 000 км, устройства которой обычно достигают скорости передачи ключей 250 кбит/с на расстоянии 43 км.
За последние 20 лет благодаря усовершенствованию оптических компонентов и улучшению электроники, в основном в детекторах, была получена постоянно растущая скорость передачи секретных ключей. Для достижения рекордно высоких скоростей около 10 Мбит/с [49] была оптимизирована цифровая обработка сигнала в ПЛИС. Пропускная способность измеряемых кубитов для повышения скорости передачи ключей также была увеличена, особенно для более коротких линий связи, за счет устранения ограничений без использования ПЛИС. Вторая гонка открыта для достижения более длинных расстояний однопролетной передачи [50-53] на основе усовершенствования протоколов, а также технологических улучшений, ведущих к детекторам с постоянно уменьшающейся скоростью темновых отсчетов. 3 Можно утверждать, что развитие, направленное на улучшение скорости передачи данных по одиночным каналам на короткие расстояния и максимальный пролет, сделает сети QKD ненужными. Однако верно и обратное, поскольку возможность открыть массовый рынок с помощью этих улучшений на уровне каналов связи представляется низкой и вряд ли позволит охватить широкие сценарии развертывания, специально используя технические усовершенствования последних лет. Что действительно позволяют последние усовершенствования, так это увеличить разнообразие каналов, которые потенциально могут быть развернуты в сетях QKD.
Поэтому разумно ожидать, что в будущем оптимальное решение будет значительно превышать нынешние значения ключевой скорости и расстояния, хотя гонка между генерацией и потреблением ключевого материала сохранится.
3.1.2 Длина канала связи. Фундаментальным ограничением QKD канала является длина, на которой может быть сгенерирован безопасный ключевой материал (из-за рассеяния и поглощения поляризованных фотонов и других факторов [27, 44, 45, 54]), что ограничивает возможности квантовых каналов (прямые оптические линии или свободная линия прямой видимости) определенным расстоянием. Интересно сравнить длины связей в ранее построенных сетях QKD. 4 Максимальная длина в QKD-сети DARPA составляла 29 км через оптический коммутатор между Гарвардским и Бостонским университетами [29]. В SECOQC максимальная длина соединения составила 82 км между узлами BREIT и St. Pölten [37], а в Токио максимальное соединение между узлами составило рекордные 90 км между узлами Koganei-1 и Koganei-2 [58]. В магистральной QKD-сети Пекин-Шанхай максимальная длина соединения составляет 89,3 км между узлами Хэфэй и Вувэй.
В современных системах с оптическими волокнами расстояние, на котором можно эффективно применять QKD-связь, ограничено примерно 100 км [26, 27].
3.1.3 Защита ключевого материала. Основной причиной интереса к QKD является конфиденциальность установленного ключевого материала. Это означает, что узлы сети QKD должны быть защищены с большой вероятностью того, что установленный ключевой материал уникален и недоступен для третьих лиц. Безопасность ключевого материала оценивается не только при его создании, но и при управлении, хранении и, в конечном итоге, использовании. Поэтому важно обеспечить безопасность каждого уровня архитектуры сети QKD.
3.1.4 Использование ключей. Из-за дефицита ресурсов (скорость генерации ключей), коммуникация в сети сводится к минимуму, поскольку каждый дополнительный пакет означает расходование дополнительного количества ранее созданного ключевого материала. Поскольку связь обычно осуществляется по принципу hop-by-hop, что требует достоверности всех узлов на пути, выбор кратчайшего пути маршрутизации необходим для минимизации количества узлов, которые потенциально могут быть похищены или атакованы подслушивающим устройством. Кроме того, использование более длинных путей требует большего расхода ключевого материала. Во время перегруженности сети или проблем со связью использованный ключевой материал намеренно отбрасывается, а для повторной передачи применяется новый ключевой материал, чтобы снизить риск утечки [28]. Поэтому минимизация количества переходов является предпочтительной.
3.1.5 Надежность. Из-за стоимости и способа реализации, сети QKD будут медленно интегрироваться в традиционные и повседневные телекоммуникационные среды. Поэтому важно обеспечить устойчивость, которая выражается в постепенном и беспрепятственном добавлении новых узлов и установлении новых связей. QKD-сеть должна обеспечивать адекватные пути замены, чтобы избежать дефектных узлов или узлов, подвергающихся серьезным атакам. Независимо от методов защиты, важно помнить, что злоумышленники могут легко найти способы прерывания оптических связей и разрыва QKD-соединений. Сеть QKD должна иметь адекватную реакцию на такие ситуации.

Поскольку трафик может быть соединен и направлен между различными сетевыми доменами, сетевые повторители играют фундаментальную роль в современных сетях. Хотя теоретические и пионерские результаты в области квантовых повторителей уже имеются [59-62], на практике они остаются недостижимыми с нынешней технологией [10, 27]. Идея квантового повторителя заключается в использовании квантовой запутанности фотонов для связи по различным квантовым каналам. Квантовая запутанность является ключевым аспектом в применении квантовых коммуникаций и квантовой информации. Вкратце, квантовая запутанность подразумевает, что несколько частиц связаны друг с другом таким образом, что измерение квантового состояния одной частицы определяет возможные квантовые состояния других частиц. Даже если частицы разделены большим расстоянием, они все равно составляют единую квантовую систему. Верность запутанности - это свойство, используемое для описания того, насколько хорошо сохраняется запутанность между двумя подсистемами в квантовом процессе.
В теории, однако, применение запутанных состояний и обмена запутанными состояниями затруднено двумя основными препятствиями. Первое заключается в том, что чем больше расстояние между двумя запутанными системами, тем ниже точность. Фактически, достижимая точность квантового состояния уменьшается экспоненциально с расстоянием из-за квантовых каналов с потерями [27, 63]. 5 В этом контексте концепция очистки запутанности [64, 65] может быть использована для повышения верности одного запутанного состояния путем использования ряда зашумленных запутанных состояний (как описано в ссылке [60]). Однако это увеличивает количество необходимых ресурсов для передачи каждого кубита через квантовый повторитель (т.е. количество запутанных состояний). Вторым препятствием на пути создания квантового повторителя по схеме, приведенной, например, в ссылках [60, 61], является то, что для квантовой памяти требуется технология, которая на сегодняшний день практически недоступна. Использование квантовых повторителей основано на идее создания "цепочек" запутанных фотонов с помощью техники, называемой обменом запутанностью. Были разработаны концепции как с квантовой памятью [66], так и без нее [67]. Различные строительные блоки для согласования передачи длин волн этих летающих кубитов с квантовой памятью были практически продемонстрированы [68, 69]. Внутренние потери и верность должны быть улучшены для реализации цепочек с одним или несколькими промежуточными узлами, работающими на более высоких скоростях. Недавно была опубликована первая работа по интеграции будущих квантовых повторителей в общую инфраструктуру [70]. Таким образом, каждый узел в сети QDK действует как ретранслятор и пересылает пакеты или состояния переключения других узлов, чтобы обеспечить обмен квантовой информацией между узлами QKD.

\subsubsection{QKD виды сетей}
Хотя было предложено множество гибридных реализаций, сети QKD можно разделить на две отдельные категории: сети QKD с коммутацией и сети QKD с доверенным ретранслятором.

Коммутируемые сети QKD состоят из узлов, подключенных к выделенной, полностью оптической сети. Эта сеть содержит механизм коммутации, используемый для установления прямого оптического QKD-соединения "точка-точка" между любыми двумя узлами сети QKD. Ограничения на расстояние в QKD-соединениях "точка-точка" ограничивают эти сети масштабами мегаполиса или региона [10]. Поскольку каждый оптический коммутатор добавляет по крайней мере несколько дБ потерь в фотонный канал, оптические коммутаторы могут значительно уменьшить радиус действия сети.
Основным недостатком коммутируемых QKD-сетей является требование выделенной оптической инфраструктуры для квантовых каналов, что часто экономически нецелесообразно. Напротив, основным преимуществом этого класса сетей является зависимость от оптического коммутатора, который позволяет установить соединение между двумя узлами без активного участия других узлов сети (Рисунок 3(a)).

Другим недостатком коммутируемых сетей QKD является согласованность применяемой техники QKD.
Объединение различных методов QKD, таких как QKD в свободном пространстве и QKD по волокну, невозможно, так как нет подходящих устройств, которые могли бы выполнить это преобразование в канале. Первая коммутируемая всепроходная сеть QKD была описана в статье [71]. Четыре узла были соединены через оптический коммутатор, и каждый из QKD-терминалов был разработан как приемопередатчик, чтобы они могли установить QKD-связь с одним из трех других одновременно.

В QKD-сетях с доверенным ретранслятором безопасность каждого узла на пути передачи необходима для безопасной передачи информации (отсюда и название). Связь "точка-точка" между двумя узлами обеспечивает идентичные ключи для узлов и, таким образом, обеспечивает безопасную связь (разделы 5.1.5 и 5.2.2). Учитывая отсутствие квантового ретранслятора, узлы также отвечают за механизмы маршрутизации и пересылки (Рисунок 3(b)). Организация сети таким образом является ее самым большим недостатком, поскольку безопасность передачи зависит от безопасности всех узлов на пути. Однако сети доверенных ретрансляторов не ограничены расстоянием или количеством узлов и могут состоять из различных QKD-устройств, реализующих различные технологии QKD.

Поскольку квантовые каналы могут быть "отданы" подслушивающему лицу без ущерба для безопасности QKD, рациональный противник скорее нацелится на более слабое звено - узел. Обычно предполагается, что узлы "неуязвимы", что является гипотезой доверенного ретранслятора. Однако, учитывая, что оптическое устройство управления в какой-то момент, скорее всего, будет иметь обычную компьютерную логику управления, безопасность устройства не лучше, чем безопасность классического компьютера, выполняющего алгоритмы QKD, и его физическая защита.
Признанное сильное предположение о полностью доверенных повторителях может быть ослаблено по крайней мере тремя способами: (i) использовать QKD, независимые от измерительных устройств (MDI), (ii) использовать квантовые повторители, и (iii) полагаться на множественные пути.

Этот первый подход был описан в [72] и добавляет предположение о совершенной подготовке состояния, достижимой сторонами связи, а также добавляет потенциально ненадежное место в квантовый канал. Измерения с использованием состояний Белла и формальные аргументы в пользу "безусловной безопасности" были подкреплены экспериментальными демонстрациями [73, 74]. Конечно, отсутствие предположения о доверенном ретрансляторе в этих доказательствах делает безопасность намного сильнее, чем в тех, которые предполагают доверенный ретранслятор QKD. Заметим, однако, что MDI QKD по существу удлиняет квантовый канал, но две станции отправителя все равно должны быть расположены в узлах доверенного ретранслятора. Это справедливо и для других альтернатив, описанных далее (за исключением, возможно, случая, когда сквозные квантовые каналы могут быть установлены без промежуточных узлов доверенного ретранслятора).

Концепция квантовых повторителей обсуждалась выше (см. раздел 3.2). Хотя были представлены практические демонстрации [61, 66, 67], пространственные расстояния, которые может преодолеть технология (на сегодняшний день), сильно зависят от количества верности, вызванной обменом запутанности, и степени, в которой с ней можно справиться (раздел 3.2).
Третий и наиболее практичный метод сегодня прибегает к классической технологии и использует множественные пути и пороговые криптографические методы для снижения риска подслушивания. Грубо говоря, квантовые сети с многопутевой передачей обменивают доверие к ретрансляторам на предположение о том, что ретранслятор уязвим для подслушивания, и злоумышленник вынужден перехватить множество промежуточных устройств, чтобы обнаружить сообщение. Действительно, можно показать, что в отсутствие доверенных ретрансляторов множественные пути являются теоретической необходимостью. В то же время, избыточность путей также смягчает проблему уязвимости всех реализаций QKD к атакам типа "отказ в обслуживании" (противник может пассивно подслушивать не для получения информации, а для того, чтобы локальные хранилища квантовых ключей иссякли и заставили конечные точки перейти на обычные методы передачи [75]).
Усовершенствованные механизмы маршрутизации могут быть использованы для обхода линий с обнаруженными подслушивающими устройствами.
Действительно, в противном случае злоумышленники могут попытаться нарушить безопасность, используя пассивное подслушивание для перенаправления трафика через уязвимые повторители и, таким образом, завладеть секретным ключом [76]. Можно показать[77, 78], что "сквозная безопасность" без доверенных повторителей в квантовых сетях (без квантовых повторителей) может быть восстановлена только при слабых предположениях об устойчивости узлов к атакам [79].
Более того, используя те же методы, можно добиться одновременной многоуровневой защиты от других атак по той же схеме до произвольно выбранного уровня качества обслуживания [80]. Топология квантовой сети обычно оказывает сильное влияние на достижимую безопасность, и, несмотря на теоретический и практический прогресс в построении квантовых сетей, даже без доверенных повторителей [33, 36, 54], проблема остается вычислительно (фактически, NP-) трудной в своей наиболее общей форме [81]. Методы борьбы со скрытыми каналами и вредоносными классическими блоками постобработки обсуждались в статье [82].
\subsubsection*{QKD оверлейные сети}
Если описанные ранее типы QKD сетей относятся к организации квантовых каналов, то тип оверлейной сети QKD относится к реализации публичных каналов. Основной целью оверлейной сети является достижение сети более высокой иерархии с целью обеспечения лучшего QoS и использования ресурсов сетей более низкого уровня. При этом оверлейная сеть стремится быть независимой от определенных путей от поставщиков интернет-услуг (ISP). Поиск альтернативных маршрутов, которые могут предоставить услугу с более высокой степенью качества, и быстрая перемаршрутизация в случае обнаружения прерывания или использования многопутевых соединений являются ключевыми особенностями подхода оверлейной сети. Использование многопутевых соединений является часто предлагаемым решением для повышения рабочей нагрузки сети за счет защиты от сбоев сети, балансировки нагрузки сети, реализации большой пропускной способности, выбора времени с малой задержкой и многого другого [83-86]. Исследования показали, что в 90\% пар точек присутствия между крупными интернет-провайдерами существует по крайней мере четыре пути с раздельными соединениями [87, 88].

Известно, что маршрутизация между сетевыми доменами с использованием внешних протоколов маршрутизации, таких как протокол Border Gateway Protocol (BGP), приводит к медленному реагированию и восстановлению после перебоев в сети. Из-за времени, необходимого для получения информации о прерываниях или перегрузках на сетевых линиях, и настройки таймера минимального интервала объявления маршрута BGP, который обычно составляет несколько минут, время, необходимое для получения согласованного представления о сети после прерывания связи, может достигать десятков минут, что является длительным периодом для сетевых приложений. BGP также распространяет только один маршрут, и определить альтернативный маршрут, необходимый узлам сети в различных ситуациях, довольно сложно [89].
Оверлейная сеть может помочь преодолеть эти проблемы путем создания сети с одноранговым подходом. Оверлейная сеть соединяет узлы в разных доменах и позволяет использовать альтернативные пути, инкапсулируя трафик в трафик в нижестоящей сети. Когда промежуточный узел на пути получает пакет, он распаковывает его, анализирует IP-адрес получателя, снова инкапсулирует пакет и передает его дальше узлам сети, которые могут находиться в других доменах. Проще говоря, это подход hop-by-hop, популярно применяемый в сетях QKD (рис. 4). Учитывая принцип инкапсуляции, узлы оверлейной сети независимо выполняют измерения состояния канала и могут быстрее реагировать на перегрузку канала, перенаправляя трафик на другие, менее загруженные каналы. Оверлейные сети могут предложить новые функциональные возможности, которые трудно реализовать в сетях нижнего уровня. Оверлейный QKD-подход привлекателен, поскольку его можно использовать для обхода "недоверенных" узлов и быстрой перемаршрутизации, когда доверие к узлам утрачено или требуется многопутевая связь [28, 33].
\subsubsection{Созданные сети QKD}
В этом разделе кратко обсуждаются некоторые ранее развернутые сети QKD. Поскольку большая часть литературы посвящена квантовой оптической инфраструктуре, основное внимание уделяется логической структуре сетей и топологии, решениям по хранению и управлению ключами, использованию ключей и производительности решения.
\subsubsection{Сеть QKD DARPA}
Первой в мире QKD-сетью стала сеть DARPA QKD Network, представленная в декабре 2002 года компанией BBN Technologies и Гарвардским и Бостонским университетами [14]. Первоначально сеть состояла из слабокогерентной пары передатчиков BB84 (Анна и Алиса), пары совместимых приемников (Борис и Боб) и одного оптического коммутатора 2x2, который мог соединить любого отправителя с любым приемником (рис. 5). Позже сеть была расширена за счет двух бесплатных космических QKD-каналов, а третий запланированный бесплатный космический канал от QinetiQ (Великобритания) не был описан ни в одной официальной документации проекта. QKD-сеть DARPA объединила два ранее описанных типа в гибридное решение. Сеть DARPA QKD заложила основу для дальнейшего развития доверенных ретрансляционных QKD-сетей, но также практически продемонстрировала недостатки коммутируемого типа QKD-сетей.
Два узла (Алиса и Боб) и коммутатор находились в BBN, а Анна и Борис - в Гарвардском и Бостонском университетах (BU), соответственно. BBN разработал свой собственный оптический коммутатор 2x2 и использовал его для соединения Анны, Алисы, Боба и Бориса. Этот переключатель был оптически пассивным и поэтому не нарушал квантовое состояние фотонов. Коммутатор был сконструирован путем модификации стандартного коммутатора телекоммуникационного оборудования. Он работает за счет перемещения отражающих элементов, которые изменяют внутренний световой путь для создания соединения BAR или CROSS. Он управляется по прямой линии от оптического технологического компьютера (OPC) Alice путем подачи импульса уровня TTL на контакт BAR или CROSS в течение 20 мс для переключения активированного положения. Согласно ссылке [29], время переключения составило 8 мс, а оптические потери - менее 1 дБ.

В ранее проведенном наборе экспериментов были представлены результаты, в которых измерялась деградация фазомодулированного QDK, вызванная оптическими коммутаторами [90]. Демонстрация передачи QKD и результаты вносимых потерь, которые были основным эффектом на пропускную способность QKD в трех различных типах оптических коммутаторов, дали следующее: Оптико-механический коммутатор 2x1 (потери 4,7 дБ),
Коммутатор 2x2 LiNbO3 (потери 5,4 дБ) и четырехпортовый MEMS-коммутатор (потери от 5,3 до 5,9 дБ).

5.1.1 Набор протоколов BBN. Учитывая, что сеть DARPA QKD была первой сетью QKD, для связи QKD по общедоступному каналу не могли использоваться предопределенные протоколы.
Поэтому BBN разработал свой собственный стек протоколов QKD на языке программирования C. Все сообщения были упакованы в IP-датаграммы для передачи управляющих сообщений через Интернет [91].
В таблице 1 представлен только список использованных технологий, в то время как заинтересованные читатели могут обратиться к ссылкам [29, 92]. Видно, что для различных этапов постобработки использовалось несколько технологий. Целью было минимизировать количество обмениваемых сообщений, чтобы ускорить скорость генерации ключей и уменьшить перегрузку, вызванную внезапной передачей большого количества пакетов по общедоступному каналу. На рисунке 6(a) показан основной формат датаграммы протокола BBN QKD. Каждая дейтаграмма содержит заголовок пакета с подробной информацией о разрешенной, надежной, упорядоченной передаче сообщения, обнаружении сбоев и так далее.
Дейтаграмма заполняется одним или несколькими сообщениями переменной длины, несущими детали, необходимые для описания команд или ответа на действие. Важно подчеркнуть, что эти дейтаграммы защищены механизмом безопасности IPSec в стандартном режиме.
Целью было создание безопасного туннеля между демонами квантового протокола, чтобы весь трафик по публичному каналу был зашифрован, аутентифицирован и проверен на целостность. Пример сообщений, которыми обменивается QKD-протокол BBN, показан на рисунке 6(b).

5.1.2 Управление ключами и их использование. В окончательном техническом отчете DARPA [29] приведены детали первоначально запланированных и использованных технологий. Интересно отметить, что авторы предполагали, что примитив согласования ключей Диффи-Хеллмана (DF) будет разрушен к 2015 году. Поскольку средняя ключевая скорость устройства QKD составляла 1 кбит/с, целью было представить QKD как новое решение для согласования ключей и интегрировать его с существующими протоколами управления ключами IPSec и IKE (Internet Key Exchange). Позже, когда ключевая скорость QKD-устройств увеличится, от IKE можно будет отказаться и принудительно использовать OTP, что приведет к созданию высокозащищенной сетевой архитектуры.
Авторы предложили использовать QKD-сеть только между чувствительными зонами, в которых конечные точки QKD использовались бы для дальнейшего распределения полученной информации по частным сетям (анклавам). Конечные точки QKD выполняли бы ту же функцию, что и пограничные маршрутизаторы в стандартных IP-сетях. Подключение конечного пользователя непосредственно к сети QKD никогда не планировалось. Основная идея заключалась в создании "резервуара" на обоих концах соответствующей QKD-связи, который постепенно заполнялся бы ключевым материалом, созданным с помощью QKD. Этот ключевой материал впоследствии будет использоваться с набором протоколов IPSec и применяться для шифрования туннелей виртуальных частных сетей (VPN).
Когда трафик принимался соответствующей конечной точкой на принимающем конце VPN-туннеля, он пересылался конечному пользователю, находящемуся в частной сети (анклаве).
Чтобы упростить процесс, но при этом использовать программное обеспечение различных платформ и производителей, конечная точка QKD была разделена на два разных компьютера. Первый компьютер, называемый Optical Process Control (OPC), использовал программное обеспечение LabView для управления соответствующим оборудованием QKD, а другой компьютер использовался для связи IPSec, маршрутизации, сетевых протоколов и протоколов QKD (просеивание, усиление конфиденциальности и т.д.). Эти два компьютера использовали локальные соединения Ethernet 100 Мбит/с. Для синхронного обмена данными использовался специализированный набор протоколов UDP 6, поставляемых BBN.

Другим важным вопросом была синхронизация между этими компьютерами и синхронизация между QKD и набором протоколов VPN. Точнее, необходимо было решить вопрос управления ключевым материалом, производимым оптическими устройствами. Процедура была следующей:

(1) Компьютер OPC поставляет блок необработанных символов фиксированного размера Qframe, переданных через оптические устройства. Он содержит указание на основания, которые были использованы для кодирования информации в фотонах. Эти блоки Qframe далее обрабатываются демоном QKD с помощью набора средств постобработки QKD (просеивание, QBER, усиление конфиденциальности или подобное), в результате чего на выходе получается Qblock.

(2) Q-блок - это блок общих битов фиксированного размера, каждый Q-блок имеет свой 16-битный идентификатор Q-блока (ID). Qблоки хранятся в резервуаре ключевого материала на обоих концах. Эти блоки хранятся непрерывно, независимо от потребления.

(3) Демон IKE использует идентификаторы Qblock для создания окончательного ключа, который затем используется IPSec, поскольку оба конца имеют одинаковый ключевой материал, хранящийся в их соответствующих резервуарах.


5.1.3 Набор протоколов IPSec. Защита протокола Интернета (IPSec) - это набор протоколов для обеспечения целостности, подлинности и конфиденциальности соединений через публичный Интернет. IPSec работает на уровне Интернет-протокола (IP) и является периметром между защищенными и незащищенными сетевыми интерфейсами, требуя уровень защиты. По умолчанию IPSec использует метод Internet Key Exchange (IKE) для автоматической передачи ключей. Основная концепция протокола IKE проста и происходит в две фазы. Первая фаза устанавливает аутентифицированный, двунаправленный, безопасный канал (Ассоциация безопасности Интернета) и протокол управления ключами (ISAKMP) SA путем обмена случайными полуключами для обмена ключами Диффи-Хеллмана. Аутентификация канала Фазы 1 осуществляется путем обмена сообщениями, зашифрованными сеансовым ключом. Случайные секретные биты Фазы 1, которые используются для установления ISAKMP, условно называются SKEYID. Эти биты считаются наиболее чувствительным моментом в точках IKE, поскольку они используются как частичный вход для создания ключей SA фазы 2 и для защиты трафика через заданную SA фазы 2. Поэтому замена этих битов время от времени, чтобы не нарушить безопасность системы, очень важна.
Вторая фаза использует биты SKEYID для согласования IPSec SAs между двумя шлюзами, которые передают трафик сообщений для определенного потока VPN-трафика. Каждая ассоциация безопасности IKE имеет максимальный срок службы, который ограничивает использование ключевого материала для ранее созданной ассоциации. Эти ограничения могут быть определены во времени (секунды) или в зашифрованных данных (килобайты) и хранятся в записи SPD для данной SA. После истечения срока действия необходимо согласовать новую SA со свежим ключевым материалом. Важно отметить, что не существует стандарта для использования OTP в IPSec. Поэтому были предложены различные решения, например, ссылки [14, 48, 97].

В сети DARPA QKD Network использовался IKE, поскольку на момент его разработки (январь 2002 года) IKE был наиболее широко распространенным протоколом согласования ключей в Интернете. Существуют два расширения, которые зависят от более позднего типа шифра:

- Расширение Quantum Perfect Forward Secrecy (QPFS), основанное на использовании техники QKD, для согласования секретных ключей, используемых в качестве семян для обычных симметричных шифров, таких как AES или 3DES. Поскольку безопасность этих симметричных шифров может быть скомпрометирована в последующие годы, целесообразно постоянное и автоматическое засеивание свежими битами QKD. В сети DARPA QKD ключи AES обновлялись примерно раз в минуту [15] путем отказа от фазы 1 переговоров и использования битов QKD в качестве прямого входа в фазу 2 IKE. Это решение повысило безопасность ассоциаций IPSec, поскольку ключи были получены из QKD вместо обмена ключами Диффи-Хеллмана (DH).

- Расширение, основанное на использовании техники QKD для согласования битов секретного ключа, используемого с шифром с одноразовым блокнотом (OTP). Это решение снижает скорость передачи данных до скорости передачи ключа QKD, поскольку ключевой материал в резервуаре для хранения заряжается только QKD.
Для реализации перечисленных расширений сетевая команда DARPA QKD расширила IKE Phase 2, добавив опцию в расширение QPFS, которая работает так же структурно, как и обычная PFS IKE Phase 2, но использует биты QKD, а не биты, полученные при обмене ключами DH. Решение было реализовано в Net BSD с помощью демона IKE "raccoon". Модификации включали механизмы политики для указания, когда и какое расширение должно использоваться, с возможностью задания значений (скорости повторного ключа, криптографических алгоритмов, ключей и т.д.) для каждого VPN-шлюза.

5.1.4 Маршрутизация в QKD-сети DARPA. Механизм маршрутизации необходим в ситуациях, когда два узла не имеют прямой QKD-связи "точка-точка" между собой и поэтому должны согласовать путь через доверенную сеть ретрансляторов.

Каждый узел имеет базу данных о полном состоянии каналов сети. Для каждого узла сети он хранит идентификатор узла и список соседних узлов. DARPA модифицировала известный протокол маршрутизации Open Shortest Path First (OSPF) [98] для использования специфической метрики сетей QKD [92]. Идея заключается в том, что каждый узел обменивается определенным количеством битов с соседним узлом, таким образом измеряя скорость обмена и общее количество обмениваемых битов (измеряя качество соединения) [99].
Качество соединения рассчитывается с использованием метрики соединения m и сохраняется в базе данных соответствующего узла: q > t, 100 + 1000q-t ,(1)m =,q < t, где q обозначает количество Qблоков, ожидаемых к наличию на соединении за один интервал обновления Link State Announcement (LSA), m - метрика соединения, а t - порог (значение по умолчанию 5) для минимального количества Qблоков, которое должно поддерживаться на активном соединении.
В дальнейшем, когда запрашивается маршрут между удаленными узлами, выбирается маршрут с наименьшей общей метрикой. Для поиска такого маршрута используется алгоритм Дейкстры. Для обновления записей в базах данных состояния соединений происходит периодический обмен сообщениями ROUT1LSA [29]. Эти сообщения содержат идентификатор узла отправляющего узла, идентификатор соседнего узла и соответствующую 32-битную метрику соединения. Сообщения ROUT1LSA обмениваются через каждый интервал обновления LSA, который является настраиваемым параметром, по умолчанию установленным на одну минуту. Каждый узел имеет индивидуальный таймер LSA, который не зависит от других узлов в сети.

Однако очевидно, что описанная модификация протокола OSPFv2 не учитывает параметры канала общего пользования. Метрика m, определенная в уравнении (1), рассматривает только количество доступного ключевого материала, не учитывая другие параметры, такие как загрузка канала или задержка [99].
Протоколы маршрутизации рассматриваются далее в разделе 6.

5.1.5 Протоколы повторителя ключей BBN для доверенных сетей. Как отмечалось выше, сеть QKD используется для преодоления ограничений, связанных с длиной канала QKD. Сеть DARPA QKD заложила основу для протокола повторителя ключей и представляет собой первую реализацию доверенной сети повторителя QKD. Здесь будет дано краткое описание этой реализации. Более подробную информацию можно найти в ссылке [29].
Когда два удаленных узла в сети QKD (т.е. узел A и узел D) хотят установить безопасную связь и между ними нет прямого соединения "точка-точка", им необходимо договориться о пути через сеть. Этот путь рассчитывается с помощью протокола маршрутизации, а узлы используют стратегию ключевого повторителя для создания ключевого материала. Узлом-источником всегда является узел с более высоким идентификатором узла. Узел-источник (узел A на рисунке 7(a)) посылает запросы на резервирование каждому узлу на пути (промежуточные узлы) и узлу назначения (узел D на рисунке 7(a)). Затем каждый узел на пути ведет переговоры со своим предшественником за Q-блок (рисунок 7(a)) и сообщает источнику об успешном завершении процесса переговоров. Если резервирование прошло успешно, источник запрашивает ключ у получателя и всех промежуточных узлов. Промежуточные узлы посылают XOR двух Q-блоков, установленных с соседними узлами, а узел назначения посылает XOR Q-блока предыдущего hop'а и новый случайный Q-блок n (рис. 7(b)). Этот Q-блок n является окончательным ключом, совместно используемым узлом-источником A и узлом назначения D.
Из вышесказанного очевидно, что метод ключевого повторителя BBN для установления ключевого материала требует времени и абсолютного доверия каждого узла, участвующего в коммуникации. Поэтому методы аутентификации имеют особое значение во всем процессе. Как уже говорилось, наиболее эффективным способом обхода скомпрометированных узлов является использование нескольких независимых путей.


5.1.6 Резюме. Сеть DARPA была первой сетью, продемонстрировавшей сетевое QKD.
Производительность, достигнутая этой сетью (максимальное расстояние 29 км через оптический коммутатор между Гарвардским и Бостонским университетами [91] и максимальная ключевая скорость 400 бит/с), считается основой для дальнейшего развертывания QKD. В системе использовались доверенный ретранслятор и коммутируемая QKD-сеть, демонстрируя преимущества и недостатки обоих методов. Краткая информация о QKD-сети DARPA приведена в таблице 2.

Однако сеть DARPA была закрыта в 2006 году, и с тех пор не сообщалось о других развертываниях в полевых условиях государственными учреждениями США. В 2017 году была объявлена Квантовая национальная инициатива, подкрепленная успешным запуском Китаем спутника "Micius" [100, 101]. В 2018 году стартап-компания Quantum Xchange объявила о планах создания первой коммерческой сети квантовой связи "Phio" в США [102, 103]. Используя собственные эксклюзивные доверенные узлы, Quantum Xchange обеспечивает безопасную передачу ключей на большие расстояния. Эта QKD-сеть работает в Вашингтоне, округ Колумбия, и Нью-Йорке, включая канал, соединяющий финансовые рынки на Уолл-стрит с центрами обработки данных в Нью-Джерси [104]. Для достижения удвоенной пропускной способности сети было объявлено о сотрудничестве с компанией Toshiba [105].

\subsubsection*{SECOQC QKD сеть}
В 2004 году интегрированный проект Европейской Комиссии (ЕК) FP6 SECOQC (Secure Communication based on Quantum Cryptography) объединил 41 научного и промышленного партнера из 11 стран Европейского Союза, России и Швейцарии. Основной целью проекта SECOQC было твердое определение практического применения технологий QKD и систематическое рассмотрение вопроса сетей QKD, включая их безопасность, дизайн и архитектуру, протоколы связи, реализацию, демонстрацию и тестовую эксплуатацию протоколов сети QKD.
Подход SECOQC заключался в определении QKD сетей как инфраструктуры, основанной на возможностях QKD "точка-точка", которые направлены на согласование ключей ITS и безопасную связь [106]. Учитывая, что первые результаты работы QKD-сети DARPA уже были доступны [92], SECOQC решил продолжить совершенствование QKD-сети типа доверенного ретранслятора. Для тестирования в Вене была развернута сеть QBB "Quantum Backbone" с городским расстоянием (6-85 км), состоящая из семи волоконно-оптических линий распределения ключей и одной короткой линии связи в свободном пространстве [57]. Пять узлов - SIE, BRT, GUD, FRM и ERD - были расположены на территории Siemens, а узел STP был размещен на ретрансляционной станции около Санкт-Пёльтена на линии связи Вена - Мюнхен, Германия.

5.2.1 Связи и узлы QBB. Как показано на рисунке 8, SECOQC объединил восемь связей, принадлежащих шести различным системам:

- Аттенюированный лазерный импульс - модифицированное, коммерчески доступное решение "Cerberis", реализованное швейцарской компанией idQuantique.

- Система одностороннего слабого когерентного импульса с ложными состояниями - реализована компанией Toshiba UK.

- Coherent-One-Way - реализована командой Н. Гизина в GAP, Женевский университет.

- Запутанные фотоны - предоставлены Австрийскими исследовательскими центрами (ARC) и Королевским технологическим институтом Киста KTH, Швеция.

- Непрерывные переменные - реализуется консорциумом CNRS-Thales-ULB из Франции/Бельгии.

- Free Space link - разработана Мюнхенским университетом Людвига Максимилиана, Германия.
Все эти системы должны были соответствовать следующим требованиям:

- Ключевая скорость более 1 кбит/с на 25 км волокна (потери 6 дБ при затухании волокна приблизительно 0,25 дБ/км в стандартном телекоммуникационном волокне).

- Автономная доставка ключа в течение более чем шести месяцев без участия человека.

- Время задержки составляет одну минуту для нового запуска. 

- Все используемое оборудование должно помещаться в стандартную 19-дюймовую телекоммуникационную стойку.

- Каждое QKD-устройство должно взаимодействовать со своим аналогом через стандартный интерфейс, предоставляемый модулем узла, управляющим командами управления общим доступом. 

Сеть SECOQC включала несколько различных решений QKD:

- Система QKD в свободном пространстве использовала протокол BB84 с ложными состояниями, что обеспечило безопасную скорость передачи ключей до 17 кбит/с на расстоянии 80 м между узлами ERD и FRM.

- Система idQuantique QKD реализовала протоколы BB84 и SARG04 с помощью коммерческой системы Cerberis, что позволило получить почти равное значение, предписанное критериями SECOQC (1 кбит/с).

- Компания Toshiba Research Europe Ltd (TREL) реализовала протокол BB84 "слабый когерентный импульс (WCP) состояние обмана плюс вакуумное состояние" и получила скорость передачи ключей 5,7 кбит/с по волокну длиной 25 км.

- В когерентной односторонней системе (COW), разработанной GAP (Группа прикладной физики Женевского университета), был реализован новый распределенный фазовый опорный протокол COW, который можно рассматривать как модификацию BB84 с фазовыми соотношениями между импульсами [28].

- QKD на основе запутанности (ENT), разработанная австрийско-шведским консорциумом, реализует BBM92 для запутанных состояний между узлами ERD и SIE по 16-км оптоволокну и обеспечивает надежную скорость передачи ключей более 2 кбит/с.

- Система Continuous-Variable (CV) была разработана в сотрудничестве между Институтом оптики Чарльза Фабрида, исследовательским центром THALES Research \& Technology France и Университетом Libre de Bruxelles. Их система достигла скорости распространения 8 кбит/с по стандартному оптическому волокну длиной 6,2 км (затухание волокна составляло приблизительно 2,8 дБ, в то время как длина эквивалентного волокна с потерями 0,2 дБ/км составила бы 14 км).

Узлы SECOQC следовали подходу DARPA, предусматривающему хранение ключевых материалов в резервуарах. Учитывая, что QKD-связи между узлами должны осуществляться по принципу "точка-точка", анод должен иметь выделенное QKD-устройство для каждого соединения с другими узлами. Ключевой материал из QKD-устройств сначала помещается в Pickup Stores. В этом временном хранилище ключевой материал хранится до тех пор, пока не будет подтверждено, что один и тот же материал находится в обоих QKD-узлах, образующих соответствующую QKD-связь. После успешного подтверждения существования одинакового ключевого материала на обоих концах, ключевой материал пересылается в общее хранилище. Для Q3P-связи (которая может содержать одну или несколько QKD-связей между двумя узлами) существует только одно общее хранилище, и ключевой материал в этом хранилище однозначно идентифицируется блоком ключевого материала. Когда запрашивается использование ключевого материала, ключи пересылаются в буферы ключей In или Out и используются для шифрования или дешифрования криптопроцессором. Организуя хранение ключей описанным образом, узлы QKD могут переносить колебания в потреблении ключей путем буферизации сгенерированного ключевого материала. Более подробную информацию об организации хранилища ключей можно найти в ссылках [28, 106].

5.2.2 Передача сообщений по принципу "хоп-хоп". Сеть SECOQC заложила основы подхода "хоп-хоп" к передаче сообщений в сети QKD. Этот способ известен как техника "Store \& Forward" и подразумевает использование отдельного ключа для каждого звена пути. Как показано на рисунке 9, каждый узел расшифровывает сообщение, проверяет аутентификационную метку и повторно шифрует сообщение, используя ключ, соответствующий соединению со следующим узлом. Эта процедура повторяется в каждом узле на пути, пока сообщение не достигнет пункта назначения [106].


5.2.3 Маршрутизация в сети SECOQC QKD. SECOQC предложил использовать структуру адресов IPv4 и географическое разделение сети QKD на несколько областей маршрутизации по следующим причинам:

- Сеть QKD - это частная сеть, которая может свободно использовать любую доступную область адресного пространства IPv4.

- Ожидать быстрого и широкого распространения сети QKD нецелесообразно. Поэтому адресного пространства IPv4 должно быть достаточно для адресации текущих и будущих узлов.

- Ограничения по расстоянию между линиями QKD не позволяют разделить сеть QKD между магистралью и произвольным числом автономных систем. Поэтому все узлы в сети должны рассматриваться одинаково.

- Отсутствие в настоящее время квантовых повторителей означает, что узлы QKD должны рассматриваться как точки доступа для приложений конечных пользователей, а не только как пересылочные узлы в сети.

Для удовлетворения требований к адресации и маршрутизации SECOQC предложил сформировать узел из следующих компонентов:

- Модули Q3P, отвечающие за связь на уровне канала с другими узлами.

- Модуль маршрутизации для сбора и ведения таблиц маршрутизации.

- Модуль пересылки для создания путей и принятия решений о пересылке.

- Другие модули для управления узлами, генерации случайных сеансовых ключей, мониторинга безопасности и так далее.

Функция модуля маршрутизации заключается в ведении локальной таблицы маршрутной информации и информировании других узлов об обновлениях в сети, чтобы они также могли обновить свои таблицы маршрутизации. Известные протоколы маршрутизации могут быть модифицированы и использованы в сети QKD, но при этом необходимо учитывать отсутствие квантового повторителя, что означает, что каждый узел сети должен быть готов принять трафик от соседнего узла и переслать его по наилучшему пути к запрашиваемому месту назначения (подробнее в разделе 6). В этом и заключается задача модуля пересылки. Модуль получает входящий пакет, проверяет значение TTL и контрольную сумму аутентификации, и в зависимости от результатов принимает решение о пересылке или отбрасывании пакета.

В SECOQC использовалась модифицированная версия протокола OSPFv2. Интересно, что OSPFv2 не поддерживает маршрутизацию QoS, которая необходима для обеспечения требуемого типа обслуживания. OSPFv2 был внедрен с целью ускорения процесса разработки [33]. В стандартном OSPF решение о пересылке принимается на основе адреса назначения и информации о кратчайшем пути в таблице маршрутизации. Однако, учитывая низкую ключевую скорость каналов QKD, при расчете наилучшего пути необходимо учитывать другие параметры.


Для вычисления структуры данных дерева кратчайших путей используется алгоритм Дейкстры. Каждый узел вычисляет уникальное дерево кратчайших путей и использует модифицированную версию OSPFv2 для составления таблицы маршрутизации. Основное отличие заключается в том, что модифицированный OSPFv2 рассчитывает несколько путей к каждому пункту назначения вместо одного кратчайшего пути. Множество путей необходимо для выполнения требований балансировки нагрузки и запасных путей. Поэтому каждый узел QKD вычисляет столько таблиц маршрутизации, сколько у него интерфейсов. OSPFv2 периодически отправляет сообщения LSA другим узлам сети с целью распространения информации о текущем состоянии сети.

Кроме того, каждый узел вычисляет расширенную таблицу маршрутизации, в которой перечислены все затраты по возрастающей величине до каждого другого узла. Эта таблица используется для объединения всех таблиц маршрутизации в одном месте. Структура таблицы похожа на стандартную таблицу маршрутизации, с той лишь разницей, что она имеет столько записей для каждого пункта назначения, сколько исходящих связей узла [33]. Теперь узел может найти несколько путей к узлу назначения, но ему также необходимо знать приблизительную нагрузку выбранных звеньев на пути. Если нагрузка на звено больше рассчитанного порога, то ищется следующее лучшее звено, и так далее. Третья таблица Load State Database вычисляется для хранения информации о приблизительной нагрузке каждого исходящего звена. Она используется для проверки того, достаточно ли ресурсов у канала для передачи сообщения [28]. Приблизительная нагрузка исходящего канала i в дискретное время t обозначается L i (t ) и рассчитывается с помощью фильтра низких частот по уравнению (2):L i (t ) = 1 -(2)- L i (t - 1) + - l i (t ), где l i (t ) - мгновенная нагрузка исходящего канала i, а w - постоянная фильтра. Мгновенная нагрузка l i (t ) рассчитывается как отношение количества переданных битов за предыдущую единицу времени. Более подробную информацию о модулях маршрутизации и пересылки можно найти в ссылках [33] и [28].


5.2.4 Резюме. Следует подчеркнуть, что разработка приложений не входила в задачи проекта SECOQC. SECOQC, однако, провел несколько экспериментов для проверки созданных решений. Во время конференции SECOQC QKD 8-10 октября 2008 года была проведена демонстрация телефонной связи и видеоконференций. Между узлами был создан VPN-туннель и использовалось шифрование AES. Ключ AES обновлялся каждые 20 секунд, а в определенные моменты шифрование AES заменялось OTP [106]. Основной целью было протестировать механизмы маршрутизации, измерить потребление и генерацию ключевого материала, а также продемонстрировать основные механизмы функционирования сети SECOQC. Стоит отметить, что в SECOQC исследовалось установление QKD-соединения с конечным пользователем [28].

Сеть SECOQC заложила основу для сетевого подхода hop-by-hop, который значительно упрощает представление о реализации решений по маршрутизации. Подход hop-by-hop позволяет каждому узлу решать, по какому дальнейшему пути направить сообщение, что обеспечивает большую гибкость при реализации протоколов маршрутизации. Однако, подход BBN key-repeater, описанный в разделе 5.1.5, требует глобального, актуального представления сети перед созданием и резервированием ресурсов на пути, что может быть требовательным из-за динамического потребления скорости генерации ключей. Сеть SECOQC также продемонстрировала совместимость между различными производителями оборудования и показала, что сеть QKD может достигать дальности почти 100 км (максимальная длина канала связи составила 82 км между узлами BREIT и St. Pölten) [37]. Краткая информация о сети SECOQC приведена в Таблице 3.

Интерес к квантовой криптографии в ЕС сопровождался проектами, финансируемыми в рамках программ Quantum Technologies Flagship, Quant Era, COST и EuraMet [107-112]. В 2019 году был объявлен проект ЕС Horizont2020 OPENQKD с консорциумом из 38 партнеров из промышленности и научных кругов [113]. Цель OPENQKD - заложить основы будущей европейской квантовой инфраструктуры и конвергенции квантовых технологий с практическими телекоммуникационными системами в Европе в течение трех лет.
\subsubsection*{Токийская сеть UQCC QKD}
Через два года после SECOQC девять организаций из Японии и Европейского Союза приняли участие в сети испытательного стенда QKD в Токио UQCC ("Japan Giga Bit Network 2 plus" - JGN2plus). Сеть состояла из частей открытой тестовой сети Национального института информационных и коммуникационных технологий Японии (NICT) под названием "Japan Giga Bit Network 2 plus" (JGN2plus) [38].
Токийская сеть QKD содержала четыре точки доступа, Хакусан, Хонго, Коганей и Отемачи, и шесть узлов, соединенных коммерческими оптическими волокнами, установленными в этих точках доступа (Рисунок 10).
Поскольку половина выбранных волокон были воздушными, на линиях связи возникали большие потери. На линии связи между узлами Когеней и Отемачи уровень потерь составил около 0,3 дБ/км, в то время как на других линиях этот показатель достигал даже 0,5 дБ/км.

Аналогично SECOQC, участники проекта реализовали определенные сетевые связи, распределенные следующим образом:

- 24-километровый канал связи между узлами Otemachi и Hakusan был предоставлен Mitsubishi Electric Corporation и NTT Company. Они реализовали протокол BB84 с максимальной скоростью передачи ключей 2 кбит/с и QBER 4,5\%.

- 45-километровый канал связи между узлами Коганей и Отемачи был предоставлен компанией NEC, реализующей протокол BB84 с ложным состоянием и сверхпроводящим однофотонным детектором (SSPD) компании NICT. Максимальная скорость передачи ключей составила 81,7 кбит/с при среднем QBER 2,7\%.

- NTT использовала DPS-QKD на самом длинном канале в сети, который составлял 90 км между узлами Koganei-1 и Koganei-2. Они также использовали детектор SSPD и достигли максимальной скорости передачи ключей 15 кбит/с при среднем QBER 2,3\% [114].

- Три организации из Австрии, включая AIT, Институт квантовой оптики и квантовой информации (IQOQI) и Венский университет, сформировали единую команду под названием "Вся Вена". Они представили свое устройство SECOQC QKD. Это устройство было основано на запутывании протокола QKD BBM92, который был размещен между узлами Koganei-2 и Koganei-3 с максимальной скоростью передачи ключей 0,25 кбит/с.

- Toshiba Research Europe Ltd. продемонстрировала свою систему BB84 с самодифференцирующимися лавинными фотодиодами (SPAPD) между узлами Koganei-2 и Otemachi-2 на 45-км линии связи. Максимальная ключевая скорость составила рекордные 304 кбит/с при среднем QBER 3,8\%. Это была самая высокая устойчивая скорость передачи ключей QKD на сегодняшний день.

- Наконец, 13-километровый канал связи между узлами Отемачи и Хонго был предоставлен компанией idQuantique из Швейцарии, использующей протокол SARG04 из своего коммерческого решения Cerberis. Максимальная скорость передачи ключей составляла 1,5 кбит/с.

Токийская сеть UQCC QKD следовала аналогичной трехслойной сетевой архитектуре, основанной на подходе доверенного ретранслятора, как это было реализовано в проекте SECOQC. Основным отличием было использование сервера управления ключами (KMS) для централизованного управления. Токийская сеть QKD пыталась протестировать сценарий правительственной сети, которая часто имеет центрального диспетчера или центральный сервер данных. KMS была установлена в узлах Koganei-1, Koganei-2, Otemachi-1 и Otemachi-2. На всех узлах были установлены агенты управления ключами, основной задачей которых было сохранение ключевого материала и хранение статистических данных по каналу связи, таких как QBER и скорость генерации ключей. Позже эти статистические данные передавались в KMS, которая координировала работу всех звеньев сети [38].

5.3.1 Резюме. В октябре 2010 года была проведена демонстрация безопасной телеконференции, обнаружения подслушивания и перенаправления каналов QKD в токийской сети UQCC QKD. 
Было установлено 2-VPN шифрование с OTP между узлами Otemachi-2 и Koganei-1. Для демонстрации алгоритма маршрутизации были использованы два маршрута, когда каналы были атакованы подслушивающим устройством. KMS обнаружила атаки из-за увеличения QBER и перенаправила связь через запасной канал.

Как отмечено в таблице 4, токийская сеть QKD показала, что технология QKD может достигать скорости в несколько сотен бит в секунду. Сеть также подтвердила возможности связи на расстоянии QKD-линии, достигнув рекордной связи в 90 км между узлами Koganei-1 и Koganei-2 [58]. Однако отличительной особенностью этой сети является внедрение иерархического подхода к организации QKD-сетей. Серверы управления ключами реализуют уровень управления и имеют полное представление о состоянии сети QKD в своем домене. Организация таким образом приблизила сеть QKD к перспективе SDN, обсуждаемой в разделе 7.

\subsubsection*{QKD-сети в Китае}
Китай строит сети QKD в национальном масштабе. Эти усилия начались со строительства тестовых городских сетей QKD в Хэфэй, где в 2009 и 2010 годах были построены трехузловая сеть [115] и пятиузловая сеть [71] соответственно. О других попытках построить оптоволоконные сети QKD сообщалось в ссылках [116-119], также формируется спутниковая сеть QKD [24]. В данном разделе представлен обзор этих разработок на примере некоторых недавно построенных оптоволоконных сетей.

5.4.1 Магистральная сеть QKD Пекин-Шанхай. В сентябре 2017 года начала работу магистральная QKD-сеть Пекин-Шанхай протяженностью 2 000 км [120]. На сегодняшний день это самая длинная сеть QKD в мире. Проект возглавляет Университет науки и технологий Китая (USTC). Среди других участников - China Cable Television Network Co, Шаньдунская академия информационных и коммуникационных технологий, Промышленный и коммерческий банк Китая (ICBC), Биржа финансовой информации Синьхуа и другие. Строительство сети было завершено в сентябре 2016 года, и перед началом эксплуатации она тестировалась в течение одного года.

Магистральная сеть состоит из 32 физических узлов, линейно соединенных QKD-связями (Рисунок 11). Среди этих узлов Пекин, Цзинань, Фули, Хэфэй, Нанкин и Шанхай являются точками доступа, а остальные - доверенными узлами-ретрансляторами. Магистральная сеть имеет в общей сложности 135 связей.
Между соседними узлами проложено от двух до восьми многократных QKD-каналов. Для экономии ресурсов волокна в сети используется технология квантового мультиплексирования с разделением по длине волны, которая объединяет четыре квантовых канала в одном волокне. Сеть арендует темное волокно, развернутое компанией China Cable Television Network Co. Расстояние между соседними узлами вдоль магистральной линии варьируется от 34 км до
89 км, при этом потери в волокне варьируются от 7,26 дБ до 22,27 дБ.
В магистральной сети используются устройства QKD, предоставленные компанией QuantumCTek Co. В устройствах реализован протокол BB84, основанный на кодировании поляризации и обманном состоянии. Некоторые из устройств интегрируют технику обнаружения одиночных фотонов с преобразованием вверх и таким образом достигают скорости обнаружения одиночных фотонов 25\%.

Магистральная сеть предназначена для функционирования в качестве канала с высокой пропускной способностью, по которому квантовые ключи передаются между столичными и QKD-сетями, расположенными в разных городах. До настоящего времени магистральная сеть была подключена к городским QKD-сетям, уже созданным в Пекине, Шанхае, Цзяне и Хэфэе. Таким образом, была сформирована широкомасштабная сеть QKD, которая предоставляет конечным пользователям, включая банки, правительственные учреждения и крупные предприятия, универсальные услуги безопасности [121].

В ноябре 2018 года было завершено расширение магистральной сети Пекин-Шанхай путем создания магистрального канала QKD между Уханем и Хэфэем. Цель заключалась в подключении городской сети QKD в Ухане к магистральной сети. Магистральная линия Ухань-Хэфэй управляется компанией CAS Quantum Network Co. В долгосрочной перспективе магистральная сеть будет расширена, чтобы охватить более обширную территорию Китая.

5.4.2 Цзинаньская государственная частная сеть QKD. Цзинаньская государственная частная сеть QKD начала строиться в апреле 2017 года и была завершена в августе 2017 года. Сеть охватывает территорию города площадью 8 000 км 2 и состоит из 32 узлов, включая узел централизованной станции управления, восемь узлов доверенных ретрансляторов и 23 узла конечных пользователей. Компания QuantumCTek Co., Ltd предоставляет системы QKD и решения по проектированию сети, а филиал China Union Shandong предоставляет оптоволоконные ресурсы [122, 123]. Всего в сети 33 линии QKD (Рисунок 12). Длина линий варьируется от 1,7 км до 64,7 км, а потери в волокне - от 1,48 дБ до 25,2 дБ. Квантовые сигналы передаются по темному волокну, предоставленному филиалом China Union Shandong.
В сети развернуты системы QKD, реализующие основанный на поляризационном кодировании протокол BB84 с ложным состоянием. Все системы предоставлены компанией QuantumCTek.

В сети используется продаваемый, самостоятельно построенный канал обслуживания, который обеспечивает безопасную передачу данных и минимальную пропускную способность 512 Мбит/с. Частная сеть Цзинань объединяет телефонную связь VoIP и услуги видеоконференций, снабженные квантовыми ключами. Доступ к услугам безопасности осуществляется через ретрансляторы, реализующие протокол IPSec VPN, снабженный квантовыми ключами.
Сеть поддерживает OTP и несколько других алгоритмов симметричного шифрования. Типичная частота обновления ключей в алгоритмах симметричного шифрования составляет один раз в секунду [124].

5.4.3 Сеть QKD столичного района Ухань. Сеть QKD в столичном округе Ухань была построена в 2017 году с января по декабрь. Сеть состоит из одного командного центра, одной централизованной станции управления, 10 доверенных узлов ретрансляторов и 60 узлов конечных пользователей (рис. 13).

Всего в сети 74 QKD-связи. Централизованная станция управления и два центральных доверенных узла ретранслятора соединены между собой, образуя сетевое кольцо. Их соединения имеют двухзвенную структуру (между каждым другим узлом устанавливается два QKD-канала). Длина самого длинного QKD-канала составила 16,5 км, а потери оптического канала, понесенные волокном, WDM-устройством и оптическим коммутатором, составили максимум 14,6 дБ на протяжении 6,7 км. Такие высокие потери в основном являются результатом сложной городской волоконно-оптической среды. Ключевая скорость каналов QKD варьируется от 2,8 кбит/с до 141 кбит/с. Системы QKD предоставлены компанией QuantumCTek [125].

Одной из особенностей сети является классическая квантовая технология WDM [126], которая объединяет классический служебный сигнал, квантовый сигнал и классический сигнал постобработки QKD в одном волокне. Доступ к службе безопасности осуществляется через ретранслятор шифрования, который реализует протокол IPSec VPN, снабженный квантовыми ключами. Типичная частота обновления ключей для симметричных алгоритмов шифрования составляет один раз в пять секунд.

5.4.4 Широкозональная QKD-сеть Хэфэй, Чаоху и Уху. О широкозональной сети QKD, соединяющей города Хэфэй, Чаоху и Вуху (HCW) в Китае, было сообщено в 2014 году в статье [119].
Вся сеть HCW QKD, на которую имеется полное техническое описание, работала более 5 000 часов с 21 декабря 2011 года по 19 июля 2012 года и была установлена в телекоммуникационной сети провинции Аньхой компании China Mobile Ltd. с зоной покрытия более 150 км.

В этой сети использовалось тринадцать QKD-устройств на девяти узлах [119]. Широкозональная сеть HCW состоит из двух городских сетей: сети QKD Хэфэй, которая имеет пять узлов [116, 117], и сети QKD Уху [118], которая имеет три узла. Эти две сети были соединены междугородним каналом QKD, который объединил столичные сети QKD Хэфэй и Уху через доверенный узел ретранслятора в филиале Чаоху компании China Mobile Ltd. [119]. [119].

В сети были развернуты системы QKD, реализующие основанный на фазовом кодировании протокол BB84 с ложным состоянием. Максимальная ключевая скорость в сети HCW QKD составляла 16,15 кбит/с между узлами Западного кампуса и Северного кампуса по линии связи длиной 3,1 км, подключенной к оптическому коммутатору, расположенному в библиотеке кампуса [119].

5.4.5 Сетевые стратегии. Магистральная сеть QKD Пекин-Шанхай и несколько других сетей QKD в городских районах используют ряд сетевых стратегий для повышения производительности и надежности сети:

- Некоторые городские сети используют кольцевую топологию при проектировании сети для повышения ее устойчивости к авариям.

- Магистральные соединения используют стратегию построения сети с несколькими параллельными каналами для повышения пропускной способности и стабильности сети.

- На некоторых основных узлах, таких как централизованные станции управления, установлены резервные устройства, которые снижают вероятность прерывания обслуживания системы, вызванного единственной точкой отказа.

5.4.6 Маршрутизация ключей в сети. Маршрутизация ключей в магистральной сети QKD Пекин-Шанхай, государственной частной сети QKD Цзинань и городской сети QKD Ухань использует архитектуру клиент-сервер для максимального использования канала и предоставления квантовых ключей конечным пользователям по требованию.
Централизованная станция управления каждой сети реализует сервер маршрутизации ключей, который отвечает за управление таблицей маршрутизации для каждого узла сети. На основе информации, собранной в сети (состояние работы QKD-соединений, оставшийся объем хранилища ключей и другая информация), таблица маршрутизации каждого узла периодически обновляется. Обновленные таблицы маршрутизации обмениваются с другими узлами сети, чтобы предоставить информацию о подходящих путях до следующего обновления [127].

Сервер маршрутизации ключей поддерживает несколько стратегий очередей, адаптированных к различным топологическим структурам сети. В случае аварийного сбоя, такого как отказ машины управления ключами или недоступность ключа, устройство узла активно сообщает об этом событии серверу маршрутизации.
Затем сервер пересчитывает таблицы маршрутизации для затронутых узлов. В магистральной сети Пекин-Шанхай маршрутизация ключей управляется путем разделения сети на несколько подсетей. Каждая подсеть принимает вышеупомянутую структуру клиент-сервер с сервером маршрутизации ключей, расположенным на узлах доступа [127, 128].

5.4.7 Резюме. С 2000-километровой линией связи, соединяющей Шанхай и Пекин, и городскими сетями в Хэфэй и Цзинань, Китай в настоящее время лидирует в гонке QKD с точки зрения практических разработок [129]. В описанных ими методологиях можно увидеть уникальные подходы к реализации существующих и доступных технологий в этих сетях QKD. Однако, в дополнение к использованию дискретных протоколов QKD, которые гарантируют высокую производительность, но требуют дорогостоящих однофотонных детекторов, также были представлены эксперименты, основанные на непрерывно-переменных и независимых от устройства измерения (MDI) QKD. Для CV-QKD были достигнуты результаты 5,77 кбит/с на расстоянии 50 км [73, 130]. Эксперименты с MDI-QKD привели к более высоким скоростям (до затухания канала): 98,2 кбит/с на расстоянии 49,1 км и до 1 Мбит/с на расстоянии в десятки километров [131]. Более того, системы QKD на основе MDI могут эффективно работать не только в симметричных каналах с одинаковыми потерями, но даже в каналах с асимметричными потерями [132]. Методы оптимизации [133] могут увеличить безопасное расстояние передачи в таких реализациях MDI-QKD более чем на 20-50 км в стандартном телекоммуникационном волокне. Краткая сводка описанных выше сетей с общедоступными ссылками приведена в таблице 5.

Не рассматривая здесь этот вопрос по соображениям компактности, важно, однако, отметить, что Китай лидирует в области квантовых технологий, ориентированных на космос. В 2017 году был запущен 640-килограммовый спутник "Micius" [134]. В ходе 273-секундного пролета спутника и с использованием 1-метрового телескопа на земле ожидалась скорость просеянного ключа от примерно 12 кбит/с на расстоянии 645 км до 1 кбит/с на расстоянии 1200 км [135]. После постобработки было получено 1,1 кбит/с для защищенного ключа.

\subsubsection{Качество обслуживания в сетях QKD}

Сходство между QKD и технологиями мобильных сетей Ad Hoc. Специфические проблемы и ограничения QKD, описанные выше, создают значительные трудности при проектировании сетей QKD. Однако анализ характеристик QKD-сетей показал сходство [136] с мобильными ад-хок сетями (MANET) и транспортными ад-хок сетями (VANET) [137-139].

Основные характеристики технологии QKD с простой точки зрения можно перечислить:

- QKD каналы, такие как описанные выше, всегда реализуются в режиме "точка-точка" и могут быть приблизительно охарактеризованы двумя особенностями: ограниченным расстоянием и скоростью передачи ключа (экспоненциально), уменьшающейся с расстоянием. Связи могут стать недоступными, когда ключевого материала недостаточно или когда канал общего пользования перегружен. Это похоже на каналы Wi-Fi, которые ограничены по дальности и скорость связи которых зависит от расстояния пользователя от антенны передатчика.

- Одной из основных особенностей существующих сетей QKD является отсутствие квантового ретранслятора (раздел 3.2), и поэтому связь обычно осуществляется по принципу "хоп-хоп".

В сетях MANET связь осуществляется по принципу "хоп-хоп", а мобильные узлы обычно питаются от энергосберегающих решений, таких как батареи. Узлы соединяются между собой самоорганизующимся, децентрализованным образом, без какого-либо органа, отвечающего за контроль и управление сетью. Основным недостатком сетей MANET является непредсказуемая мобильность узлов, которая часто может привести к нестабильным путям маршрутизации [114]. Количество заряда батареи и мобильность узлов MANET можно легко связать с количеством ключевого материала в хранилище ключей QKD. Ограниченный радиус действия беспроводных каналов связи во многом схож с ограничениями на длину QKD-связи. Отсутствие специализированной сетевой инфраструктуры (например, маршрутизаторов) - еще одно сходство между этими двумя технологиями. Слабая мобильность узлов QKD, однако, делает ее похожей на технологию VANET, в которой связь происходит по заранее определенному пути.

Хотя на первый взгляд сети MANET и сети QKD не имеют ничего общего, простой анализ особенностей этих сетей показывает их сходство. Однако, что четко отличает эти две сети, так это их назначение. Сети MANET предназначены для быстрой и простой связи в ситуациях, когда нет возможности использовать уже существующую инфраструктуру (например, поисково-спасательные операции во время стихийных бедствий или в зонах военных действий). В отличие от этого, основной целью QKD является обеспечение связи ИТС. Это может оказать существенное влияние при выборе сетевых решений, поскольку решение, необходимое в одной ситуации, может оказаться непригодным в другой. Например, рассмотрим решения маршрутизации, основанные на сетевом наводнении. Сети QKD опираются на предположение, что все узлы являются доверенными, когда связь осуществляется по принципу hop-by-hop или с повторением ключа [32, 39], и, строго следуя этому предположению, подслушивающее устройство ограничивается атакой только на каналы QKD. Из-за природы QKD подслушивающее устройство не может получить никакой информации о ключе, передаваемом по каналу связи, но ему может быть отказано в обслуживании, чтобы отключить связь. Хотя были получены результаты по объединению нескольких путей для создания безопасного ключевого материала [27, 82], считается, что объем маршрутной информации, передаваемой узлам, должен быть сведен к минимуму. Для предотвращения атаки типа "отказ в обслуживании" ни один узел (кроме источника и получателя) в сети не должен знать запрос на маршрутизацию. Поэтому количество широковещательных пакетов должно быть сведено к минимуму. Более того, учитывая основную цель QKD, которая заключается в обеспечении связи ITS, пакеты маршрутизации должны быть либо аутентифицированы и зашифрованы, либо, по крайней мере, аутентифицированы [140]. Это означает, что количество маршрутных пакетов в сети должно быть минимизировано (накладные расходы на маршрутизацию) относительно материала, который должен быть сохранен для защиты данных, что является основной целью безопасной связи. Из этого следует, что протоколы, основанные на переполнении, не являются предпочтительными в сетях QKD.
\subsubsection*{Протоколы маршрутизации}
В ранее развернутых сетях QKD особое внимание уделялось квантовым каналам. Общественный канал, однако, в основном игнорировался и предполагалось, что он каким-то образом достижим без каких-либо трудностей. Приоритетность сетевого трафика и сигнальные протоколы игнорировались, и решения в существующих обычных сетях были, соответственно, модифицированы для нужд QKD-сетей. Первое такое решение, основанное на модификации известного протокола маршрутизации Open Shortest Path First (OSPF) [98], было реализовано в сети DARPA BBN QKD, построенной в 2004 году в США [92]. Вместо использования метрики маршрутизации hop-count, был использован модифицированный протокол OSPFv2 для определения качества соединения в зависимости от количества ключевого материала в хранилище ключей. Как обсуждалось в разделе 5.1.4, модифицированная версия OSPFv2 не учитывает статус канала общего пользования [99].

Аналогичный подход был предложен в статье [141], где автор предложил использовать незашифрованную и неаутентифицированную связь для распространения пакетов маршрутизации OSPFv2. Очевидно, что такая сеть является легкой добычей для подслушивающего устройства, имеющего в своем распоряжении неограниченные ресурсы, особенно в плане пассивного подслушивания [76]. Поскольку описанное решение основано на использовании ключевого материала в хранилище ключей в качестве метрики маршрутизации, оно не может обеспечить эффективную маршрутизацию из-за отсутствия информации о состоянии открытого канала.

В сети SECOQC была внедрена еще одна модифицированная версия протокола OSPFv2 [28,
33]. Оно было основано на локальной политике балансировки нагрузки, рассчитываемой как отношение количества переданных битов за определенный период времени. Как обсуждалось в разделе 5.2.3, подобное решение не учитывает доступное количество ключевого материала, что означает, что алгоритм может выбрать путь с недостаточным количеством ключевого материала для передачи данных.

При создании китайской сети HCW QKD был применен подход к резервированию квантовых ключей (QKDRA), основанный на модели IntServ [142, 143]. Для поиска пути от источника к узлу назначения используется протокол OSPFv2. После определения пути узел источника отправляет запрос на резервирование ключа всем узлам на пути. После получения запроса промежуточный узел отвечает сообщением о результате резервирования ключа. Наконец, узел назначения определяет возможность установления соединения. Поскольку OSPFv2 фокусируется на поиске кратчайшего пути, отсюда и название, решения, представленные в ссылках [142, 143], находят кратчайший путь между источником и пунктом назначения и резервируют достаточное количество ключевого материала на выбранном пути. Обратите внимание, что этот путь может быть не оптимальным. Точнее, путь является кратчайшим, но он может быть неоптимальным с точки зрения QoS. Известно, что маршрутизация с минимальным количеством hop (кратчайшая) обычно находит маршруты со значительно меньшей пропускной способностью, чем наилучший из доступных [144], поскольку она не учитывает другие параметры соединения. OSPFv2 в своем первоначальном виде не учитывает ограничения QoS; поэтому он не может гарантировать, что трафик на выбранном пути будет адекватно обслуживаться. Резервирование ресурсов на квантовом канале, в этом случае, не дает выигрыша, так как путь для публичного канала может оказаться неподходящим. Однако даже расширенная версия OSPFv2, включающая ограничения QoS [145], может оказаться неоптимальной для сетей QKD. Реализация OSPFv2 таким образом может найти путь, который имеет наилучшие характеристики публичного канала, но не учитывает параметры квантового канала.
Янг предложил использовать алгоритм Дейкстры для определения нескольких путей, но без учета состояния канала общего пользования [146]. Идея состоит в том, чтобы использовать пороговые значения для исключения связей, которые имеют меньшее количество ключевого материала, и периодически передавать подробности маршрутизации, такие как количество доступного ключевого материала.

Влияние состояний открытого канала на ключевую скорость можно найти в ссылке [147]. Это исследование показывает, что канал общего пользования не должен исключаться из расчетов маршрута, поскольку производительность канала общего пользования влияет на квантовый канал и наоборот. Поэтому вводятся новые метрики для уникального описания состояния публичного и квантового каналов, а также всей QKD-связи [147, 148]. С целью минимизации потребления ключей следует избегать флудинга сети, поэтому была представлена одноуровневая организация сети и протокол маршрутизации Greedy Perimeter Stateless Routing Protocol for QKD networks (GPSRQ) [136]. Протокол маршрутизации GPSRQ использует распределенную географию и реактивную маршрутизацию для достижения высокого уровня масштабируемости. Он оснащен механизмом кэширования и обнаружения возвращающихся петель, что позволяет осуществлять пересылку при минимизации потребления ключевого материала. Однако применение GPSRQ ограничено только планарной топологией, поскольку географическая маршрутизация в сетях с непланарной топологией не может быстро определить кратчайший путь, что приводит к ненужной пересылке и повышенному расходу дефицитного ключевого материала.

Маршрутизация в сетях QKD зависит в первую очередь от архитектуры организации сети (иерархическая или распределенная архитектура, оверлейная или одностековая сеть, сеть hop-by-hop или сеть ключевых повторителей). В отличие от обычных сетей, решения по маршрутизации в QKD-сетях должны учитывать оба канала QKD-связи. Исходя из требования минимизации потребления ключей, необходимо уменьшить количество маршрутных пакетов, которые должны быть зашифрованы и аутентифицированы или, по крайней мере, аутентифицированы, чтобы избежать активных и пассивных подслушивающих атак QKD-сети [28, 140].

Учитывая усилия по распространению сети QKD на мегаполисы, что предполагает значительное количество сетевых узлов, в ранее реализованных сетях рассматривалась иерархическая организация [42, 125, 149-151]. Этот подход, основанный на уровне управления ключами, сходится к парадигме сети на основе программного обеспечения и более подробно рассматривается в разделе 7.

\subsubsection{QKD разработка сетевых технологий}
Более эволюционная стратегия применения QKD в транспортных сетях заключается в использовании преимуществ последних разработок в области сетевых технологий, а точнее, в области управления сетями.
Программно-определяемые сети (SDN) [152, 153] позволяют разделить плоскости контроля (управления) и данных (пересылки). С момента своего появления в 2008 году эта технология приобрела большую популярность как в академической, так и в промышленной сферах. SDN позволяет быстрее интегрировать новые технологии и услуги, обеспечивая при этом централизованное управление и оптимизацию на основе принципов программируемости и конфигурируемости сети. Хотя подход к SDN изменился по сравнению с программируемостью устройств на основе OpenFlow в сторону открытых и стандартных интерфейсов, эта трансформация помогла сетевым операторам все больше внедрять SDN в свои системы, чтобы сократить время выхода на рынок и уменьшить привязку к поставщикам.

Сеть SDN концептуально состоит из трех уровней. Уровень контроля и управления знает состояние всей сети и может оптимизировать ее поведение с помощью централизованной структуры, известной как контроллер SDN. Контроллер определяет возможности устройств, установленных на инфраструктурном уровне, с помощью набора стандартных механизмов (southbound interface). Он также знает требования различных приложений, работающих в сети, через стандартные интерфейсы (северный интерфейс). Его роль заключается в оптимизации ресурсов и предоставлении средств для выполнения задач устройствами и сервисами. Система QKD, установленная в инфраструктуре, может экспортировать свои требования контроллеру, чтобы он мог создать определенный путь с необходимыми оптическими характеристиками (например, максимально допустимый шум, затухание и т.д.) для соединения излучателя с приемником (одно или многоходовый путь) и удовлетворить требования приложения. Это позволяет создать беспрецедентное средство для создания полностью интегрированной классической/квантовой сети и действительно QKD-устройств с нулевой конфигурацией, которые могут быть напрямую подключены к стандартной телекоммуникационной сети.

До появления этой технологии демонстрации требовали либо создания отдельной сети ad-hoc только для квантового канала (т.е., как правило, сети темных волокон), либо специальных модификаций сети для каждого канала [154, 155]. Это очень дорогие и совершенно ортогональные развертывания для обычной телекоммуникационной деятельности, в которой устройства, как ожидается, будут работать "из коробки" и делить волокно со многими другими обычными каналами связи. Для того чтобы QKD стало стандартом, критически важно, чтобы системы QKD следовали тенденциям и архитектурам, используемым в сегменте транспортных сетей.

Другие проекты и демонстрации показали первые шаги к автоматизации сетей QKD.
В ссылках [156, 157] авторы реализовали механизм автоматизации переключения квантового канала между передатчиком и двумя смоделированными приемниками с помощью оптических кросс-коннект-коммутаторов с поддержкой OpenFlow. В этом смысле и несмотря на то, что в данном случае средством обеспечения является контроллер программно-определяемой оптической сети (SDON), исследование больше сосредоточено на применении безопасной миграции виртуальных машин в сценарии распределенного центра обработки данных.
Самый передовой вклад в программно-определяемые сети QKD был представлен в ссылках [158-160] (Рисунок 14(b)). Были подключены три производственных объекта в сети Telefonica в Испании. Предложенная архитектура и демонстрации были направлены на демонстрацию технологической зрелости систем QKD для интеграции в производственные сети. Системы CV-QKD, использованные для испытаний, были реализованы таким образом, чтобы ими можно было управлять и оптимизировать с помощью программных процессов, и были достаточно надежными, чтобы сосуществовать с традиционными каналами связи. В программное обеспечение была интегрирована первая версия интерфейса SDN, определенного Группой отраслевых спецификаций (ISG) для QKD в Европейском институте телекоммуникационных стандартов (ETSI). С помощью этого интерфейса системы QKD и процессы доставки ключей централизованно управляются контроллером SDN, что позволяет динамически создавать квантовые каналы (через оптические коммутаторы), создавать многоходовые ассоциации и определять запросы на ключи от внешних приложений. Эта установка также была разработана таким образом, чтобы любой канал управления и передачи данных мог интегрировать ключи, полученные с помощью QKD, для защиты коммуникаций, связанных либо с сетью QKD, либо с традиционными телекоммуникационными услугами, работающими в производственной сети.

QKD также можно рассматривать как дополнительный уровень безопасности для транспортных сетей. Интеграция QKD в SDN является взаимовыгодной, поскольку ключи, полученные с помощью QKD, могут использоваться для защиты различных уровней транспортной сети. Помимо демонстрации, проведенной в статье [157], в которой для обеспечения безопасности использовался алгоритм шифрования (AES), авторы в статье [161] показали, как существующие протоколы безопасности, используемые в плоскости управления, могут интегрировать квантовую криптографию плавным эволюционным способом, не затрагивая текущие схемы. Будучи совместимой в обеих криптосистемах (QKD и традиционных или даже постквантовых схемах), безопасность предложенной системы обеспечивает лучшее из обоих: сертификация традиционных схем по-прежнему применима к гибридной системе, а безопасность полученного решения является максимально возможной, поскольку взлом конечного ключа означает, что обе криптосистемы должны быть скомпрометированы. Данное решение развернуто в каналах управления, организующих работу контроллера SDN и архитектуры виртуализации сетевых функций (NFV) посредством протоколов SSH и TLS.

В [162] сообщалось об эксперименте по мониторингу и смягчению атак физического уровня на основе SDN. Мониторинг QBER и скорости секретного ключа в реальном времени использовался для перерасчета маршрутов для установления квантового канала.
В других случаях больше внимания уделялось безопасности плоскости данных и созданию сервисов. Marksteiner представил интеграцию QKD-производных ключей в каналы IPSec, сосредоточив свое исследование на безопасности и масштабируемости решения в зависимости от пропускной способности сервиса [163]. В дополнение к этому исследованию, подход, о котором сообщается в справочнике [164], сосредоточен на автоматизации услуг для зашифрованных каналов в сквозной сети. Автоматизация была предложена для сценариев центра обработки данных (реализация расширений в OpenFlow) и для транспортных сегментов (использование MPLS и NETCONF для конфигурации). Это было интегрировано в виртуальные сетевые функции, реализующие расширения и канал безопасности с использованием IPSec, как в ссылке [163]. Компания Mavromat продемонстрировала использование QKD для энергоэффективного SDN-управления устройствами Интернета вещей [165].
Мы также отмечаем эксперименты с использованием SDN для управления WDM-организацией QKDлинков [156, 166-168], а также использование моделей машинного обучения (ML) для прогнозирования качества Ch-QKD в сетях QKD-DWDM с повышением эффективности оптических сетей с поддержкой SDN [169].

В широкой сети QKD, где несколько арендаторов QKD используют одну и ту же базовую инфраструктуру, решение проблемы безопасного распределения ключей имеет важное значение для эффективного управления сетью. Cao предложил подход к распределению скорости секретного ключа на основе SDN с использованием эвристического алгоритма с помощью моделирования [170].
Многопользовательская организация может обслуживаться с использованием подхода "ключ как услуга" (KaaS), при котором пулы ключей (KP), определенные на уровне управления иерархии SDN, отображаются на виртуальные пулы ключей с помощью RESTful API на уровне приложений.
Эти результаты показывают, что SDN следует рассматривать как технологический инструмент для интеграции QKD в транспортные сети. В то же время, QKD также приносит пользу сети, поскольку реализует дополнительный уровень ITS для критических инфраструктур. Такой интеграционный подход позволяет плавно интегрировать системы QKD в сеть и коммерциализировать QKD на различных уровнях обслуживания (самовосстанавливающиеся сетевые инфраструктуры, сквозные услуги на различных уровнях OSI и т.д.).

\subsubsection{Заключение}
Квантовая криптография является привлекательной криптографической технологией, которая привлекла внимание различных организаций в академических и промышленных сообществах. В последние годы заметный прогресс в развитии оптического оборудования отразился в ряде успешных демонстраций технологии QKD. Эти демонстрации показывают большие достижения в квантовой криптографии и подчеркивают практические трудности, которые еще предстоит решить.
Мы приводим краткое изложение основных ключевых моментов, связанных с QKD-сетями. Доверенные повторители необходимы для увеличения безопасного расстояния передачи квантовых каналов. Решения для интеграции сетей QKD в существующие оптические сети связи в настоящее время являются актуальной темой в оптических исследованиях. Реальные сети квантовой криптографии, используемые конечными пользователями для реальных приложений передачи информации, станут следующей вехой. С точки зрения промышленности, стандарты для оценки безопасности, производства и применения QKD уже определяются[189, 190].

В настоящее время человек, оказавшийся в лаборатории QKD и спрашивающий о максимально достижимой ключевой скорости, получит ответ с вопросом о расстоянии, которое он/она хочет преодолеть.
Как упоминалось в разделе 3, одним из основных недостатков QKD-соединений является ограничение по длине. Однако сети, обсуждаемые в этом документе, демонстрируют значительное развитие оптического оборудования в последнее время. В 2002 году системы QKD достигли скорости передачи ключей в 1 кбит/с [29], которая использовалась в сети DARPA QKD. В 2007 году в SECOQC эта ключевая скорость увеличилась в десять раз [37], а в 2011 году в токийской сети QKD была достигнута ключевая скорость 300 кбит/с [38]. Этой скорости передачи ключей было достаточно для организации видеоконференции, защищенной шифром OTP, предоставленным QKD. Интересно также сравнить длину связей в этих сетях. Максимальная длина соединения в сети DARPAQKD составляла 29 км через оптический коммутатор между Гарвардским и Бостонским университетами [91]. В SECOQC максимальная длина QKD-связи составила 82 км между узлами BREIT и St. Pölten [37]. В Токио максимальное расстояние составило рекордные 90 км между узлами Коганей-1 и Коганей-2 [171]. В Хэфэй-Чаоху-Вуху (HCW) в Китае максимальное расстояние составило
85,1 км по междугородней линии HCW между Хэфэй и Чаоху [119, 191].
Поэтому разумно ожидать повышения ключевой ставки и увеличения расстояния в ближайшие годы.
Поскольку прогнозируется, что оптические квантовые повторители станут доступными для практического использования в будущем [57], в настоящее время сети QKD реализуются исключительно с помощью подхода доверенных повторителей (TRA). TRA необходим для преодоления ограничений расстояния между QKD-каналами и для обеспечения маршрутизации в QKD-сетях. Однако TRA имеет ряд ограничений, которые необходимо устранить, если сеть QKD будет применяться в повседневной жизни и интегрирована с обычными IP-сетями.
Одним из способов широкого применения технологии QKD является интеграция в телекоммуникационные сети с использованием такого подхода, как SDN-QKD.
\subsection{\review}
This article talks about quantum networks for transmitting information. The article can be divided into several logical parts.  In the first part the authors consider existing technical solutions, in the second part the prospects of quantum key distribution development, and in the third part they make conclusions about the current state of quantum technologies

This article is a review, the authors do not describe new discoveries, they only describe the current state of science in the field of quantum technologies: quantum key distribution, quantum Internet and quantum data networks.

\subsection{\dic}
ss